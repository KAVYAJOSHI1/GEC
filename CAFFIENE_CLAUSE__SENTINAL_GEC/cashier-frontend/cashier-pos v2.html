<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Petpooja ‚Äî Cashier Terminal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link
    href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --pp-orange: #F05A28;
      --pp-orange-lt: #FF7043;
      --pp-orange-bg: #FFF3EF;
      --pp-orange-glow: rgba(240, 90, 40, 0.15);
      --bg: #F4F5F7;
      --white: #FFFFFF;
      --surface2: #F8F9FA;
      --border: #E4E7EC;
      --border2: #D0D5DD;
      --green: #12B76A;
      --green-bg: #ECFDF3;
      --green-bdr: #A9EFC5;
      --red: #F04438;
      --red-bg: #FEF3F2;
      --red-bdr: #FEA3A3;
      --blue: #2E7DFF;
      --blue-bg: #EFF6FF;
      --blue-bdr: #BFDBFE;
      --amber: #F79009;
      --amber-bg: #FFFAEB;
      --amber-bdr: #FEC84B;
      --text-primary: #101828;
      --text-secondary: #475467;
      --text-tertiary: #98A2B3;
      --mono: 'IBM Plex Mono', monospace;
      --sans: 'Plus Jakarta Sans', sans-serif;
      --r-sm: 6px;
      --r-md: 10px;
      --r-lg: 12px;
      --r-xl: 16px;
      --shadow-sm: 0 1px 3px rgba(16, 24, 40, 0.06), 0 1px 2px rgba(16, 24, 40, 0.04);
      --shadow-md: 0 4px 12px rgba(16, 24, 40, 0.08), 0 2px 4px rgba(16, 24, 40, 0.04);
      --shadow-lg: 0 12px 32px rgba(16, 24, 40, 0.12), 0 4px 8px rgba(16, 24, 40, 0.06);
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--sans);
      background: var(--bg);
      color: var(--text-primary);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      user-select: none;
    }

    /* HEADER */
    header {
      background: var(--white);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      height: 60px;
      flex-shrink: 0;
      position: relative;
      z-index: 10;
      box-shadow: var(--shadow-sm);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .pp-logo img {
      height: 28px;
      width: auto;
      display: block;
    }

    .pp-logo-fallback {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pp-logo-fallback .pp-icon {
      width: 30px;
      height: 30px;
      background: var(--pp-orange);
      border-radius: var(--r-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .pp-logo-fallback .pp-wordmark {
      font-weight: 800;
      font-size: 17px;
      color: var(--pp-orange);
      letter-spacing: -0.3px;
    }

    .divider-v {
      width: 1px;
      height: 28px;
      background: var(--border);
      flex-shrink: 0;
    }

    .module-badge {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .module-badge .bdot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--pp-orange);
    }

    .module-badge span {
      font-size: 12px;
      font-weight: 700;
      color: var(--pp-orange);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .cashier-chip {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 100px;
      padding: 4px 12px 4px 5px;
    }

    .cashier-avatar {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: var(--pp-orange);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 800;
      color: white;
    }

    .cashier-name-wrap .cn {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1;
    }

    .cashier-name-wrap .cs {
      font-family: var(--mono);
      font-size: 9px;
      color: var(--text-tertiary);
      letter-spacing: 0.3px;
    }

    .header-center {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }

    #clock {
      font-family: var(--mono);
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: 2px;
      line-height: 1;
    }

    #date-str {
      font-family: var(--mono);
      font-size: 9px;
      color: var(--text-tertiary);
      letter-spacing: 1.5px;
      text-transform: uppercase;
      margin-top: 2px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hdr-tag {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 5px 10px;
      border-radius: 100px;
      font-family: var(--mono);
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 0.5px;
      border: 1px solid;
    }

    .hdr-tag.shift {
      background: var(--pp-orange-bg);
      border-color: rgba(240, 90, 40, 0.25);
      color: var(--pp-orange);
    }

    .hdr-tag.cash {
      background: var(--green-bg);
      border-color: var(--green-bdr);
      color: var(--green);
    }

    .hdr-tag.conn {
      background: var(--green-bg);
      border-color: var(--green-bdr);
      color: var(--green);
    }

    .hdr-tag.conn-warn {
      background: var(--amber-bg);
      border-color: var(--amber-bdr);
      color: var(--amber);
    }

    .conn-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
      animation: pconn 2s infinite;
    }

    @keyframes pconn {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: 0.3
      }
    }

    .maint-toggle {
      display: flex;
      align-items: center;
      gap: 7px;
      padding: 5px 10px;
      border-radius: 100px;
      border: 1px solid var(--border2);
      background: var(--white);
      cursor: pointer;
      transition: all 0.2s;
    }

    .maint-toggle:hover {
      background: var(--bg);
    }

    .maint-toggle.active {
      background: var(--amber-bg);
      border-color: var(--amber-bdr);
    }

    .tog-track {
      width: 26px;
      height: 14px;
      background: var(--border2);
      border-radius: 100px;
      position: relative;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .maint-toggle.active .tog-track {
      background: var(--amber);
    }

    .tog-knob {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      position: absolute;
      top: 2px;
      left: 2px;
      transition: left 0.2s;
    }

    .maint-toggle.active .tog-knob {
      left: 14px;
    }

    .tog-lbl {
      font-family: var(--mono);
      font-size: 9px;
      font-weight: 600;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }

    .maint-toggle.active .tog-lbl {
      color: var(--amber);
    }

    /* MAIN */
    .main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* POS PANEL */
    .pos-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      padding: 14px;
      gap: 12px;
    }

    .cat-tabs {
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }

    .cat-tab {
      padding: 7px 15px;
      border-radius: 100px;
      border: 1.5px solid var(--border);
      background: var(--white);
      font-family: var(--sans);
      font-weight: 600;
      font-size: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.15s;
      box-shadow: var(--shadow-sm);
    }

    .cat-tab:hover {
      border-color: var(--pp-orange);
      color: var(--pp-orange);
      background: var(--pp-orange-bg);
    }

    .cat-tab.active {
      background: var(--pp-orange);
      border-color: var(--pp-orange);
      color: white;
      font-weight: 700;
      box-shadow: 0 2px 8px var(--pp-orange-glow);
    }

    .item-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      overflow-y: auto;
      flex: 1;
      padding-right: 2px;
    }

    .item-grid::-webkit-scrollbar {
      width: 4px;
    }

    .item-grid::-webkit-scrollbar-thumb {
      background: var(--border2);
      border-radius: 4px;
    }

    .item-card {
      background: var(--white);
      border: 1.5px solid var(--border);
      border-radius: var(--r-xl);
      padding: 16px 12px 14px;
      cursor: pointer;
      transition: all 0.18s cubic-bezier(0.34, 1.56, 0.64, 1);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      text-align: center;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-sm);
    }

    .item-card:hover {
      border-color: var(--pp-orange);
      transform: translateY(-3px);
      box-shadow: var(--shadow-md), 0 0 0 3px var(--pp-orange-bg);
    }

    .item-card:active {
      transform: scale(0.96);
    }

    .item-card .emoji {
      font-size: 28px;
      line-height: 1;
    }

    .item-card .item-name {
      font-size: 11px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.3;
    }

    .item-card .item-price {
      font-family: var(--mono);
      font-size: 12px;
      font-weight: 700;
      color: var(--pp-orange);
      background: var(--pp-orange-bg);
      padding: 2px 8px;
      border-radius: 100px;
    }

    .item-card .add-ripple {
      position: absolute;
      background: var(--pp-orange);
      opacity: 0;
      border-radius: 50%;
      transform: scale(0);
      width: 80px;
      height: 80px;
      top: 50%;
      left: 50%;
      margin: -40px 0 0 -40px;
      pointer-events: none;
    }

    @keyframes ripple {
      0% {
        transform: scale(0);
        opacity: 0.25
      }

      100% {
        transform: scale(3);
        opacity: 0
      }
    }

    /* CART PANEL */
    .cart-panel {
      width: 310px;
      background: var(--white);
      border-left: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      box-shadow: -2px 0 8px rgba(16, 24, 40, 0.04);
    }

    .cart-header {
      padding: 14px 16px 12px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .cart-header-title {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .cart-header-title h3 {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .cart-count {
      background: var(--pp-orange);
      color: white;
      border-radius: 100px;
      padding: 1px 8px;
      font-size: 11px;
      font-weight: 800;
      font-family: var(--mono);
    }

    .cart-items {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }

    .cart-items::-webkit-scrollbar {
      width: 3px;
    }

    .cart-items::-webkit-scrollbar-thumb {
      background: var(--border);
    }

    .cart-empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--text-tertiary);
      gap: 10px;
    }

    .cart-empty-icon {
      font-size: 36px;
      opacity: 0.35;
    }

    .cart-empty p {
      font-size: 12px;
      font-weight: 500;
    }

    .cart-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 9px 8px;
      border-radius: var(--r-md);
      margin-bottom: 2px;
      transition: background 0.12s;
      animation: slideIn 0.2s ease;
    }

    .cart-row:hover {
      background: var(--bg);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(10px)
      }

      to {
        opacity: 1;
        transform: translateX(0)
      }
    }

    .cr-emoji {
      font-size: 16px;
      flex-shrink: 0;
    }

    .cr-name {
      flex: 1;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .cr-qty {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .qty-btn {
      width: 22px;
      height: 22px;
      border-radius: 6px;
      border: 1.5px solid var(--border2);
      background: var(--bg);
      cursor: pointer;
      font-size: 13px;
      font-weight: 700;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.1s;
    }

    .qty-btn:hover {
      background: var(--pp-orange);
      color: white;
      border-color: var(--pp-orange);
    }

    .qty-num {
      font-family: var(--mono);
      font-size: 12px;
      font-weight: 700;
      min-width: 18px;
      text-align: center;
      color: var(--text-primary);
    }

    .cr-price {
      font-family: var(--mono);
      font-size: 12px;
      font-weight: 700;
      color: var(--pp-orange);
      min-width: 52px;
      text-align: right;
    }

    .remove-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-tertiary);
      font-size: 16px;
      line-height: 1;
      transition: color 0.1s;
      padding: 2px;
    }

    .remove-btn:hover {
      color: var(--red);
    }

    .cart-summary {
      padding: 12px 16px;
      border-top: 1px solid var(--border);
      background: var(--bg);
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 5px;
      font-family: var(--mono);
    }

    .summary-row.total {
      font-size: 17px;
      font-weight: 800;
      color: var(--text-primary);
      border-top: 1.5px solid var(--border);
      padding-top: 10px;
      margin-top: 6px;
      margin-bottom: 0;
      font-family: var(--sans);
    }

    .summary-row.total span:last-child {
      color: var(--pp-orange);
    }

    .pay-actions {
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 7px;
      border-top: 1px solid var(--border);
    }

    .pay-btn {
      width: 100%;
      padding: 12px 16px;
      border-radius: var(--r-lg);
      border: none;
      font-family: var(--sans);
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 7px;
      transition: all 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .pay-btn:hover {
      transform: translateY(-1px);
    }

    .pay-btn:active {
      transform: scale(0.97);
    }

    .pay-btn.cash {
      background: var(--pp-orange);
      color: white;
      box-shadow: 0 3px 10px var(--pp-orange-glow);
      font-size: 14px;
      padding: 13px;
    }

    .pay-btn.cash:hover {
      background: var(--pp-orange-lt);
      box-shadow: 0 6px 16px var(--pp-orange-glow);
    }

    .pay-btn.upi {
      background: var(--blue-bg);
      color: var(--blue);
      border: 1.5px solid var(--blue-bdr);
    }

    .pay-btn.upi:hover {
      background: #dbeafe;
    }

    .pay-btn.nosale {
      background: var(--bg);
      color: var(--text-secondary);
      border: 1.5px solid var(--border2);
    }

    .pay-btn.nosale:hover {
      background: var(--border);
      color: var(--text-primary);
    }

    .pay-row {
      display: flex;
      gap: 7px;
    }

    .pay-row .pay-btn {
      flex: 1;
    }

    .pay-btn.void {
      background: transparent;
      color: var(--red);
      border: 1.5px solid var(--red-bdr);
      font-size: 11px;
      padding: 8px;
    }

    .pay-btn.void:hover {
      background: var(--red-bg);
    }

    /* LOGS PANEL */
    .logs-panel {
      width: 220px;
      background: var(--white);
      border-left: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .logs-header {
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logs-header h3 {
      font-family: var(--mono);
      font-size: 9px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-tertiary);
    }

    .live-badge {
      display: flex;
      align-items: center;
      gap: 5px;
      font-family: var(--mono);
      font-size: 9px;
      font-weight: 700;
      color: var(--red);
      letter-spacing: 1px;
    }

    .live-dot {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: var(--red);
      animation: blink 1.4s infinite;
    }

    @keyframes blink {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: 0.2
      }
    }

    .log-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }

    .log-list::-webkit-scrollbar {
      width: 2px;
    }

    .log-list::-webkit-scrollbar-thumb {
      background: var(--border);
    }

    .log-item {
      padding: 9px 10px;
      border-radius: var(--r-md);
      margin-bottom: 5px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-left: 3px solid transparent;
      animation: logSlide 0.25s ease;
      box-shadow: var(--shadow-sm);
    }

    @keyframes logSlide {
      from {
        opacity: 0;
        transform: translateY(-6px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    .log-item.cash {
      border-left-color: var(--green);
    }

    .log-item.upi {
      border-left-color: var(--blue);
    }

    .log-item.nosale {
      border-left-color: var(--amber);
    }

    .log-item.void {
      border-left-color: var(--red);
    }

    .log-type {
      font-family: var(--mono);
      font-size: 9px;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-bottom: 3px;
    }

    .log-item.cash .log-type {
      color: var(--green);
    }

    .log-item.upi .log-type {
      color: var(--blue);
    }

    .log-item.nosale .log-type {
      color: var(--amber);
    }

    .log-item.void .log-type {
      color: var(--red);
    }

    .log-amount {
      font-family: var(--mono);
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .log-items-str {
      font-size: 10px;
      color: var(--text-tertiary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .log-time {
      font-family: var(--mono);
      font-size: 9px;
      color: var(--text-tertiary);
      margin-top: 2px;
    }

    .shift-controls {
      padding: 10px;
      border-top: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .shift-btn {
      width: 100%;
      padding: 8px;
      border-radius: var(--r-md);
      border: 1.5px solid var(--border2);
      background: var(--bg);
      color: var(--text-secondary);
      font-family: var(--sans);
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .shift-btn:hover {
      background: var(--border);
      color: var(--text-primary);
    }

    .shift-btn.danger {
      color: var(--red);
      border-color: var(--red-bdr);
      background: var(--white);
    }

    .shift-btn.danger:hover {
      background: var(--red-bg);
      border-color: var(--red);
    }

    /* MODALS */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(16, 24, 40, 0.5);
      backdrop-filter: blur(4px);
      z-index: 100;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.open {
      display: flex;
    }

    .modal {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 28px;
      width: 380px;
      box-shadow: var(--shadow-lg);
      animation: modalIn 0.22s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes modalIn {
      from {
        transform: scale(0.92) translateY(8px);
        opacity: 0
      }

      to {
        transform: scale(1) translateY(0);
        opacity: 1
      }
    }

    .modal-header {
      margin-bottom: 20px;
    }

    .modal-header h2 {
      font-size: 19px;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .modal-header p {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .modal-total {
      background: var(--bg);
      border: 1.5px solid var(--border);
      border-radius: var(--r-md);
      padding: 12px 14px;
      margin-bottom: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-total .label {
      font-size: 11px;
      color: var(--text-tertiary);
      font-family: var(--mono);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .modal-total .amount {
      font-family: var(--mono);
      font-size: 21px;
      font-weight: 700;
      color: var(--pp-orange);
    }

    .modal-input {
      width: 100%;
      padding: 12px 14px;
      background: var(--bg);
      border: 1.5px solid var(--border2);
      border-radius: var(--r-md);
      font-family: var(--mono);
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 10px;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    .modal-input::placeholder {
      color: var(--text-tertiary);
      font-weight: 400;
    }

    .modal-input:focus {
      border-color: var(--pp-orange);
      box-shadow: 0 0 0 3px var(--pp-orange-bg);
    }

    .change-display {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      background: var(--green-bg);
      border: 1px solid var(--green-bdr);
      border-radius: var(--r-md);
      margin-bottom: 14px;
    }

    .change-display span {
      font-size: 11px;
      color: var(--text-secondary);
      font-family: var(--mono);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .change-display strong {
      font-family: var(--mono);
      font-size: 16px;
      font-weight: 700;
      color: var(--green);
    }

    .modal-actions {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .modal-btn {
      flex: 1;
      padding: 12px;
      border-radius: var(--r-md);
      border: none;
      font-family: var(--sans);
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .modal-btn.confirm {
      background: var(--pp-orange);
      color: white;
      box-shadow: 0 3px 10px var(--pp-orange-glow);
    }

    .modal-btn.confirm:hover {
      background: var(--pp-orange-lt);
    }

    .modal-btn.cancel {
      background: var(--bg);
      color: var(--text-secondary);
      border: 1.5px solid var(--border2);
    }

    .modal-btn.cancel:hover {
      background: var(--border);
      color: var(--text-primary);
    }

    .numpad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 5px;
      margin-bottom: 10px;
    }

    .nk {
      padding: 13px;
      border-radius: var(--r-md);
      border: 1.5px solid var(--border2);
      background: var(--bg);
      font-family: var(--mono);
      font-size: 17px;
      font-weight: 700;
      cursor: pointer;
      color: var(--text-primary);
      text-align: center;
      transition: all 0.1s;
    }

    .nk:hover {
      background: var(--pp-orange);
      color: white;
      border-color: var(--pp-orange);
    }

    .nk:active {
      transform: scale(0.93);
    }

    .nk.del {
      color: var(--red);
    }

    .nk.del:hover {
      background: var(--red);
      color: white;
      border-color: var(--red);
    }

    .nk.zero {
      grid-column: span 2;
    }

    .reason-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      margin-bottom: 14px;
    }

    .reason-btn {
      padding: 11px 10px;
      border-radius: var(--r-md);
      border: 1.5px solid var(--border2);
      background: var(--bg);
      font-family: var(--sans);
      font-weight: 600;
      font-size: 11px;
      cursor: pointer;
      text-align: center;
      color: var(--text-secondary);
      transition: all 0.15s;
    }

    .reason-btn:hover,
    .reason-btn.selected {
      border-color: var(--pp-orange);
      background: var(--pp-orange-bg);
      color: var(--pp-orange);
    }

    .report-card {
      background: var(--bg);
      border: 1.5px solid var(--border);
      border-radius: var(--r-md);
      padding: 14px;
      margin-bottom: 14px;
    }

    .rep-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      margin-bottom: 7px;
      color: var(--text-secondary);
    }

    .rep-row.final {
      border-top: 1px solid var(--border2);
      padding-top: 9px;
      margin-top: 9px;
      margin-bottom: 0;
      font-weight: 700;
      color: var(--text-primary);
      font-size: 14px;
    }

    .rep-val {
      font-family: var(--mono);
      font-weight: 700;
    }

    .rep-val.good {
      color: var(--green);
    }

    .rep-val.bad {
      color: var(--red);
    }

    /* TOAST */
    .toast-container {
      position: fixed;
      top: 72px;
      right: 16px;
      z-index: 200;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .toast {
      padding: 10px 16px;
      border-radius: var(--r-lg);
      font-size: 12px;
      font-weight: 600;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: 8px;
      animation: toastIn 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
      min-width: 220px;
      max-width: 320px;
      border: 1px solid;
      background: var(--white);
      font-family: var(--sans);
    }

    @keyframes toastIn {
      from {
        transform: translateX(40px);
        opacity: 0
      }

      to {
        transform: translateX(0);
        opacity: 1
      }
    }

    .toast.success {
      border-color: var(--green-bdr);
      color: var(--green);
    }

    .toast.error {
      border-color: var(--red-bdr);
      color: var(--red);
    }

    .toast.warning {
      border-color: var(--amber-bdr);
      color: var(--amber);
    }

    .toast.info {
      border-color: var(--blue-bdr);
      color: var(--blue);
    }
  </style>
</head>

<body>

  <header>
    <div class="header-left">
      <!-- Petpooja official logo from CDN -->
      <div class="pp-logo" id="ppLogo">
        <img src="https://petpoojaweb.gumlet.io/images/home-new/petpoojaSmall_logo.svg" alt="Petpooja"
          onerror="document.getElementById('ppLogo').style.display='none'; document.getElementById('ppFallback').style.display='flex';">
      </div>
      <div class="pp-logo-fallback" id="ppFallback" style="display:none;">
        <div class="pp-icon">üçΩÔ∏è</div>
        <div class="pp-wordmark">petpooja</div>
      </div>

      <div class="divider-v"></div>
      <div class="module-badge">
        <div class="bdot"></div>
        <span>Cashier POS</span>
      </div>
      <div class="divider-v"></div>
      <div class="cashier-chip">
        <div class="cashier-avatar" id="cashierAvatar">R</div>
        <div class="cashier-name-wrap">
          <div class="cn" id="cashierDisplayName">Riya Sharma</div>
          <div class="cs">STORE #PP-042 ¬∑ COUNTER 1</div>
        </div>
      </div>
    </div>

    <div class="header-center">
      <div id="clock">--:--:--</div>
      <div id="date-str">Loading...</div>
    </div>

    <div class="header-right">
      <div class="hdr-tag shift" id="shift-label">SHIFT PENDING</div>
      <div class="hdr-tag cash" id="cash-inventory-tag">üéí ‚Çπ0</div>
      <div class="maint-toggle" id="safetyToggle" onclick="toggleSafety()">
        <div class="tog-track">
          <div class="tog-knob"></div>
        </div>
        <div class="tog-lbl" id="togLabel">MAINTENANCE</div>
      </div>
      <div class="hdr-tag conn" id="connTag">
        <div class="conn-dot"></div>
        <span id="conn-text">ONLINE</span>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="pos-panel">
      <div class="cat-tabs" id="catTabs">
        <button class="cat-tab active" data-cat="all">All Items</button>
        <button class="cat-tab" data-cat="food">üçõ Food</button>
        <button class="cat-tab" data-cat="drinks">ü•§ Drinks</button>
        <button class="cat-tab" data-cat="snacks">üçø Snacks</button>
        <button class="cat-tab" data-cat="desserts">üç∞ Desserts</button>
      </div>
      <div class="item-grid" id="itemGrid"></div>
    </div>

    <div class="cart-panel">
      <div class="cart-header">
        <div class="cart-header-title">
          <h3>Current Order</h3>
          <span class="cart-count" id="cartCount">0</span>
        </div>
      </div>
      <div class="cart-items" id="cartItems">
        <div class="cart-empty">
          <div class="cart-empty-icon">üõí</div>
          <p>Tap items to add</p>
        </div>
      </div>
      <div class="cart-summary" id="cartSummary" style="display:none;">
        <div class="summary-row"><span>Subtotal</span><span id="subtotal">‚Çπ0.00</span></div>
        <div class="summary-row"><span>GST (5%)</span><span id="gstamt">‚Çπ0.00</span></div>
        <div class="summary-row total"><span>Total</span><span id="totalamt">‚Çπ0.00</span></div>
      </div>
      <div class="pay-actions">
        <button class="pay-btn cash" onclick="openCashModal()">üíµ Cash Sale</button>
        <div class="pay-row">
          <button class="pay-btn upi" onclick="processUPI()">üì± UPI / Card</button>
          <button class="pay-btn nosale" onclick="openNoSaleModal()">üîì No-Sale</button>
        </div>
        <button class="pay-btn void" onclick="voidOrder()">‚úï Void Order</button>
      </div>
    </div>

    <div class="logs-panel">
      <div class="logs-header">
        <h3>Transactions</h3>
        <div class="live-badge">
          <div class="live-dot"></div>LIVE
        </div>
      </div>
      <div class="log-list" id="logList">
        <div style="padding:20px;text-align:center;color:var(--text-tertiary);font-size:11px;font-family:var(--mono)">No
          transactions yet</div>
      </div>
      <div class="shift-controls">
        <button class="shift-btn" onclick="shiftEnd()">‚è∏ End Shift</button>
        <button class="shift-btn" onclick="dayEnd()">üìä Day End Report</button>
        <button class="shift-btn danger" onclick="lockTerminal()">üîí Lock Terminal</button>
      </div>
    </div>
  </div>

  <!-- CASH MODAL -->
  <div class="modal-overlay" id="cashModal">
    <div class="modal">
      <div class="modal-header">
        <h2>üíµ Cash Payment</h2>
        <p>Enter amount received from customer</p>
      </div>
      <div class="modal-total"><span class="label">Order Total</span><span class="amount" id="modalTotal">‚Çπ0.00</span>
      </div>
      <input class="modal-input" id="cashReceived" placeholder="‚Çπ Amount received" readonly>
      <div class="numpad" id="numpad"></div>
      <div class="change-display"><span>Change to return</span><strong id="changeAmt">‚Çπ0.00</strong></div>
      <div class="modal-actions">
        <button class="modal-btn cancel" onclick="closeModal('cashModal')">Cancel</button>
        <button class="modal-btn confirm" onclick="confirmCash()">‚úì Confirm Sale</button>
      </div>
    </div>
  </div>

  <!-- NO-SALE MODAL -->
  <div class="modal-overlay" id="noSaleModal">
    <div class="modal">
      <div class="modal-header">
        <h2>üîì No-Sale Open</h2>
        <p>Select reason for opening cash drawer</p>
      </div>
      <div class="reason-grid">
        <button class="reason-btn" onclick="selectReason(this,'Change for Customer')">üí± Change for Customer</button>
        <button class="reason-btn" onclick="selectReason(this,'Float Adjustment')">‚öñÔ∏è Float Adjustment</button>
        <button class="reason-btn" onclick="selectReason(this,'Petty Cash Out')">üí∏ Petty Cash Out</button>
        <button class="reason-btn" onclick="selectReason(this,'Cash Count')">üî¢ Cash Count</button>
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" onclick="closeModal('noSaleModal')">Cancel</button>
        <button class="modal-btn confirm" id="noSaleConfirm" onclick="confirmNoSale()"
          style="opacity:0.4;pointer-events:none;">Open Drawer</button>
      </div>
    </div>
  </div>

  <!-- START SHIFT MODAL -->
  <div class="modal-overlay" id="startShiftModal" style="z-index:300;">
    <div class="modal">
      <div style="text-align:center;margin-bottom:22px;">
        <img src="https://petpoojaweb.gumlet.io/images/home-new/petpoojaSmall_logo.svg" alt="Petpooja"
          style="height:30px;margin-bottom:16px;display:block;margin-left:auto;margin-right:auto;"
          onerror="this.style.display='none'">
        <div style="font-size:19px;font-weight:800;color:var(--text-primary);margin-bottom:4px;">Start Your Shift</div>
        <div style="font-size:13px;color:var(--text-secondary);">Enter your details to begin the session</div>
      </div>
      <input class="modal-input" id="cashierName" placeholder="Your Name" style="font-size:14px;margin-bottom:10px;">
      <input class="modal-input" id="initialCash" type="number" placeholder="‚Çπ Opening Float (e.g. 2000)"
        style="font-size:14px;">
      <div class="modal-actions" style="margin-top:18px;">
        <button class="modal-btn confirm" style="padding:13px;" onclick="apiStartShift()">Start Shift ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- END SHIFT MODAL -->
  <div class="modal-overlay" id="endShiftModal">
    <div class="modal">
      <div class="modal-header">
        <h2>üèÅ End Shift</h2>
        <p>Count the drawer and enter the actual cash total</p>
      </div>
      <div class="modal-total"><span class="label">Expected Cash (System)</span><span class="amount"
          id="expectedDisplay">Computing...</span></div>
      <input class="modal-input" id="closingCash" type="number" placeholder="‚Çπ Actual Cash Count">
      <div class="modal-actions" style="margin-top:18px;">
        <button class="modal-btn cancel" onclick="closeModal('endShiftModal')">Cancel</button>
        <button class="modal-btn confirm" onclick="apiEndShift()">Submit & Close</button>
      </div>
    </div>
  </div>

  <!-- REPORT MODAL -->
  <div class="modal-overlay" id="reportModal">
    <div class="modal">
      <div class="modal-header">
        <h2>üìä Shift Report</h2>
        <p>Summary of your shift performance</p>
      </div>
      <div class="report-card" id="reportContent"></div>
      <div class="modal-actions"><button class="modal-btn confirm" onclick="location.reload()">Start New Shift</button>
      </div>
    </div>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <script>
    const ITEMS = [
      { id: 1, name: 'Paneer Burger', price: 149, emoji: 'üçî', cat: 'food' },
      { id: 2, name: 'Veg Biryani', price: 189, emoji: 'üçõ', cat: 'food' },
      { id: 3, name: 'Masala Dosa', price: 99, emoji: 'ü´ì', cat: 'food' },
      { id: 4, name: 'Chole Bhature', price: 120, emoji: 'ü´ï', cat: 'food' },
      { id: 5, name: 'Aloo Paratha', price: 80, emoji: 'ü•ô', cat: 'food' },
      { id: 6, name: 'Dal Makhani', price: 160, emoji: 'üç≤', cat: 'food' },
      { id: 7, name: 'Cold Coffee', price: 89, emoji: '‚òï', cat: 'drinks' },
      { id: 8, name: 'Fresh Lime Soda', price: 60, emoji: 'ü•§', cat: 'drinks' },
      { id: 9, name: 'Mango Shake', price: 99, emoji: 'ü•≠', cat: 'drinks' },
      { id: 10, name: 'Masala Chai', price: 30, emoji: 'üçµ', cat: 'drinks' },
      { id: 11, name: 'Coconut Water', price: 50, emoji: 'ü••', cat: 'drinks' },
      { id: 12, name: 'Samosa (2pc)', price: 40, emoji: 'ü•ü', cat: 'snacks' },
      { id: 13, name: 'Pav Bhaji', price: 110, emoji: 'üç±', cat: 'snacks' },
      { id: 14, name: 'Kachori', price: 35, emoji: 'ü´î', cat: 'snacks' },
      { id: 15, name: 'Bread Pakora', price: 55, emoji: 'üçû', cat: 'snacks' },
      { id: 16, name: 'Gulab Jamun', price: 60, emoji: 'üçÆ', cat: 'desserts' },
      { id: 17, name: 'Kheer', price: 80, emoji: 'üçß', cat: 'desserts' },
      { id: 18, name: 'Rabri', price: 70, emoji: 'üç®', cat: 'desserts' },
      { id: 19, name: 'Jalebi', price: 50, emoji: 'üçØ', cat: 'desserts' },
      { id: 20, name: 'Rasmalai', price: 90, emoji: 'üç∞', cat: 'desserts' },
    ];

    let cart = {}, logs = [], currentCat = 'all', selectedReason = null, currentShiftId = null, safetyMode = false;

    function updateClock() {
      const n = new Date(), p = x => String(x).padStart(2, '0');
      document.getElementById('clock').textContent = `${p(n.getHours())}:${p(n.getMinutes())}:${p(n.getSeconds())}`;
      const D = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'], M = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
      document.getElementById('date-str').textContent = `${D[n.getDay()]}  ${n.getDate()} ${M[n.getMonth()]} ${n.getFullYear()}`;
      const h = n.getHours();
      document.getElementById('shift-label').textContent = h < 12 ? 'MORNING SHIFT' : h < 17 ? 'AFTERNOON SHIFT' : 'EVENING SHIFT';
    }
    setInterval(updateClock, 1000); updateClock();

    setInterval(() => {
      const t = document.getElementById('connTag'), tx = document.getElementById('conn-text');
      if (Math.random() < 0.97) { t.className = 'hdr-tag conn'; tx.textContent = 'ONLINE'; }
      else { t.className = 'hdr-tag conn-warn'; tx.textContent = 'RECONNECTING'; setTimeout(() => { t.className = 'hdr-tag conn'; tx.textContent = 'ONLINE'; }, 1500); }
    }, 8000);

    function renderItems() {
      const grid = document.getElementById('itemGrid');
      const items = currentCat === 'all' ? ITEMS : ITEMS.filter(i => i.cat === currentCat);
      grid.innerHTML = items.map(it => `<div class="item-card" onclick="addToCart(${it.id},this)"><div class="emoji">${it.emoji}</div><div class="item-name">${it.name}</div><div class="item-price">‚Çπ${it.price}</div><div class="add-ripple" id="ripple-${it.id}"></div></div>`).join('');
    }

    document.getElementById('catTabs').addEventListener('click', e => {
      const b = e.target.closest('.cat-tab'); if (!b) return;
      document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
      b.classList.add('active'); currentCat = b.dataset.cat; renderItems();
    });

    function addToCart(id, el) {
      const item = ITEMS.find(i => i.id === id);
      cart[id] = cart[id] || { ...item, qty: 0 }; cart[id].qty++; renderCart();
      const r = el.querySelector('.add-ripple'); r.style.animation = 'none'; r.offsetHeight; r.style.animation = 'ripple 0.5s ease forwards';
    }
    function changeQty(id, d) { if (!cart[id]) return; cart[id].qty += d; if (cart[id].qty <= 0) delete cart[id]; renderCart(); }
    function removeFromCart(id) { delete cart[id]; renderCart(); }

    function renderCart() {
      const keys = Object.keys(cart);
      document.getElementById('cartCount').textContent = keys.reduce((a, k) => a + cart[k].qty, 0);
      const ie = document.getElementById('cartItems'), se = document.getElementById('cartSummary');
      if (!keys.length) { ie.innerHTML = '<div class="cart-empty"><div class="cart-empty-icon">üõí</div><p>Tap items to add</p></div>'; se.style.display = 'none'; return; }
      se.style.display = 'block';
      ie.innerHTML = keys.map(k => { const it = cart[k]; return `<div class="cart-row"><span class="cr-emoji">${it.emoji}</span><div class="cr-name">${it.name}</div><div class="cr-qty"><button class="qty-btn" onclick="changeQty(${k},-1)">‚àí</button><span class="qty-num">${it.qty}</span><button class="qty-btn" onclick="changeQty(${k},1)">+</button></div><div class="cr-price">‚Çπ${(it.price * it.qty).toFixed(0)}</div><button class="remove-btn" onclick="removeFromCart(${k})">√ó</button></div>`; }).join('');
      const sub = keys.reduce((a, k) => a + cart[k].price * cart[k].qty, 0), gst = sub * 0.05;
      document.getElementById('subtotal').textContent = `‚Çπ${sub.toFixed(2)}`;
      document.getElementById('gstamt').textContent = `‚Çπ${gst.toFixed(2)}`;
      document.getElementById('totalamt').textContent = `‚Çπ${(sub + gst).toFixed(2)}`;
    }

    function getTotal() { return Object.keys(cart).reduce((a, k) => a + cart[k].price * cart[k].qty, 0) * 1.05; }
    function getOrderDesc() { const k = Object.keys(cart); if (!k.length) return 'Empty'; return k.slice(0, 2).map(k => cart[k].name).join(', ') + (k.length > 2 ? `+${k.length - 2}` : ''); }

    function buildNumpad() {
      document.getElementById('numpad').innerHTML = ['7', '8', '9', '4', '5', '6', '1', '2', '3', 'DEL', '0', '.'].map(k => `<button class="nk ${k === 'DEL' ? 'del' : ''} ${k === '0' ? 'zero' : ''}" onclick="numpadKey('${k}')">${k === 'DEL' ? '‚å´' : k}</button>`).join('');
    }
    function numpadKey(k) {
      const inp = document.getElementById('cashReceived'); let v = inp.value.replace('‚Çπ', '');
      if (k === 'DEL') v = v.slice(0, -1); else if (k === '.') v = v.includes('.') ? v : v + '.'; else if (v.length < 8) v += k;
      inp.value = v ? `‚Çπ${v}` : ''; updateChange();
    }
    function updateChange() {
      const r = parseFloat(document.getElementById('cashReceived').value.replace('‚Çπ', '')) || 0, t = getTotal(), c = r - t;
      const el = document.getElementById('changeAmt'); el.textContent = c >= 0 ? `‚Çπ${c.toFixed(2)}` : '‚Çπ0.00'; el.style.color = c >= 0 ? 'var(--green)' : 'var(--red)';
      const cd = el.closest('.change-display');
      if (c >= 0 && r > 0) { cd.style.background = 'var(--green-bg)'; cd.style.borderColor = 'var(--green-bdr)'; }
      else { cd.style.background = 'var(--red-bg)'; cd.style.borderColor = 'var(--red-bdr)'; }
    }

    function openCashModal() {
      if (!Object.keys(cart).length) { showToast('Add items to cart first!', 'error'); return; }
      document.getElementById('modalTotal').textContent = `‚Çπ${getTotal().toFixed(2)}`;
      document.getElementById('cashReceived').value = ''; document.getElementById('changeAmt').textContent = '‚Çπ0.00';
      buildNumpad(); document.getElementById('cashModal').classList.add('open');
    }
    function closeModal(id) { document.getElementById(id).classList.remove('open'); }

    async function confirmCash() {
      const r = parseFloat(document.getElementById('cashReceived').value.replace('‚Çπ', '')) || 0, t = getTotal();
      if (r < t) { showToast('Amount insufficient!', 'error'); return; }
      const desc = getOrderDesc();
      await syncEventToBackend('SALE', t, desc, 'CASH'); updateInventoryDisplay(t);
      addLog('cash', t, desc); closeModal('cashModal'); clearCart();
      showToast(`‚úì Cash sale complete! Change: ‚Çπ${(r - t).toFixed(2)}`, 'success'); drawerOpenAnimation('CASH SALE');
    }

    async function syncEventToBackend(type, amt, desc, mode = 'CASH') {
      try { const r = await fetch('http://127.0.0.1:8000/api/pos-logs/', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ transaction_id: `TX-${Date.now()}`, event_type: type, amount: amt, description: desc, payment_mode: mode }) }); if (!r.ok) throw new Error(); }
      catch (e) { showToast('Backend offline ‚Äî logged locally.', 'warning'); }
    }

    async function processUPI() {
      if (!Object.keys(cart).length) { showToast('Add items to cart first!', 'error'); return; }
      const t = getTotal(), d = getOrderDesc(); await syncEventToBackend('SALE', t, d + ' (UPI)', 'UPI');
      addLog('upi', t, d); clearCart(); showToast('‚úì UPI/Card payment recorded!', 'success');
    }

    function openNoSaleModal() {
      selectedReason = null; document.querySelectorAll('.reason-btn').forEach(b => b.classList.remove('selected'));
      const c = document.getElementById('noSaleConfirm'); c.style.opacity = '0.4'; c.style.pointerEvents = 'none';
      document.getElementById('noSaleModal').classList.add('open');
    }
    function selectReason(el, r) {
      document.querySelectorAll('.reason-btn').forEach(b => b.classList.remove('selected')); el.classList.add('selected'); selectedReason = r;
      const c = document.getElementById('noSaleConfirm'); c.style.opacity = '1'; c.style.pointerEvents = 'auto';
    }
    async function confirmNoSale() {
      if (!selectedReason) return; await syncEventToBackend('NO_SALE', 0, selectedReason);
      addLog('nosale', 0, selectedReason); closeModal('noSaleModal'); showToast(`üîì No-Sale: ${selectedReason} ‚Äî Logged`, 'warning'); drawerOpenAnimation('NO-SALE');
    }
    async function voidOrder() {
      if (!Object.keys(cart).length) { showToast('Nothing to void.', 'error'); return; }
      const t = getTotal(), d = getOrderDesc(); await syncEventToBackend('VOID', t, d);
      addLog('void', t, d); clearCart(); showToast('‚úï Order voided and logged.', 'error');
    }

    function addLog(type, amount, desc) {
      const n = new Date(), time = n.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      logs.unshift({ id: Date.now(), type, amount, desc, time }); if (logs.length > 20) logs.pop(); renderLogs();
    }
    function renderLogs() {
      const list = document.getElementById('logList'), show = logs.slice(0, 5);
      if (!show.length) { list.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text-tertiary);font-size:11px;font-family:var(--mono)">No transactions yet</div>'; return; }
      const labels = { cash: 'CASH SALE', upi: 'UPI/CARD', nosale: 'NO-SALE', void: 'VOID' };
      list.innerHTML = show.map(l => `<div class="log-item ${l.type}"><div class="log-type">${labels[l.type]}</div>${l.amount > 0 ? `<div class="log-amount">‚Çπ${l.amount.toFixed(2)}</div>` : ''}<div class="log-items-str">${l.desc}</div><div class="log-time">${l.time}</div></div>`).join('');
    }

    function clearCart() { cart = {}; renderCart(); }
    function showToast(msg, type = 'info') {
      const c = document.getElementById('toastContainer'), icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' }, el = document.createElement('div');
      el.className = `toast ${type}`; el.innerHTML = `<span>${icons[type]}</span><span>${msg}</span>`; c.appendChild(el); setTimeout(() => el.remove(), 3500);
    }
    async function drawerOpenAnimation(label) {
      showToast(`üóÉÔ∏è Cash drawer opened ‚Äî ${label}`, 'info');
      try { await fetch('http://127.0.0.1:8000/api/drawer-events/', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ status: 'OPEN', linked_transaction_id: 'CASHIER_UI' }) }); } catch (e) { }
    }

    function setActiveCashier(name) {
      document.getElementById('cashierDisplayName').textContent = name;
      document.getElementById('cashierAvatar').textContent = name.charAt(0).toUpperCase();
    }

    async function checkActiveShift() {
      try {
        const res = await fetch('http://127.0.0.1:8000/api/shifts/current/'); const data = await res.json();
        if (data.active === false || data.error) { document.getElementById('startShiftModal').classList.add('open'); }
        else { currentShiftId = data.id; setActiveCashier(data.cashier_name); const bal = data.expected_cash || data.initial_cash; document.getElementById('cash-inventory-tag').textContent = `üéí ‚Çπ${bal.toFixed(0)}`; showToast(`Welcome back, ${data.cashier_name}!`, 'success'); }
      } catch (e) { document.getElementById('startShiftModal').classList.add('open'); }
    }

    async function apiStartShift() {
      const name = document.getElementById('cashierName').value.trim();
      const initial = parseFloat(document.getElementById('initialCash').value) || 0;
      if (!name) return showToast('Enter your name to continue', 'error');
      try {
        const res = await fetch('http://127.0.0.1:8000/api/shifts/start/', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ cashier_name: name, initial_cash: initial }) });
        if (res.ok) { const data = await res.json(); currentShiftId = data.id; }
      } catch (e) { currentShiftId = 'LOCAL-' + Date.now(); }
      setActiveCashier(name); document.getElementById('cash-inventory-tag').textContent = `üéí ‚Çπ${initial.toFixed(0)}`;
      closeModal('startShiftModal'); showToast(`üöÄ Shift started ‚Äî Welcome, ${name}!`, 'success');
    }

    function shiftEndUI() { document.getElementById('endShiftModal').classList.add('open'); document.getElementById('expectedDisplay').textContent = 'Calc on Server...'; }
    let shiftEnd = shiftEndUI;

    async function apiEndShift() {
      const actual = parseFloat(document.getElementById('closingCash').value) || 0;
      try { const res = await fetch('http://127.0.0.1:8000/api/shifts/end/', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ actual_cash: actual }) }); if (res.ok) { const data = await res.json(); closeModal('endShiftModal'); showReport(data); } }
      catch (e) { showToast('Failed to end shift', 'error'); }
    }

    function showReport(data) {
      const d = data.discrepancy, g = Math.abs(d) < 10;
      document.getElementById('reportContent').innerHTML = `<div class="rep-row"><span>Opening Float</span><span class="rep-val">‚Çπ${data.initial_cash}</span></div><div class="rep-row"><span>Expected Cash</span><span class="rep-val">‚Çπ${data.expected_cash}</span></div><div class="rep-row"><span>Actual Count</span><span class="rep-val">‚Çπ${data.actual_cash}</span></div><div class="rep-row final"><span>Discrepancy</span><span class="rep-val ${g ? 'good' : 'bad'}">${d > 0 ? '+' : ''}${d.toFixed(2)}</span></div><div style="font-size:10px;margin-top:8px;color:var(--text-tertiary);font-family:var(--mono)">${g ? '‚úÖ Balanced perfectly!' : '‚ö†Ô∏è Discrepancy logged.'}</div>`;
      document.getElementById('reportModal').classList.add('open');
    }

    async function updateInventoryDisplay(add = 0) {
      const el = document.getElementById('cash-inventory-tag');
      let curr = parseFloat(el.textContent.replace(/[^\d.]/g, '')) || 0; el.textContent = `üéí ‚Çπ${(curr + add).toFixed(0)}`;
      try { const res = await fetch('http://127.0.0.1:8000/api/shifts/current/'); const d = await res.json(); if (d.expected_cash) el.textContent = `üéí ‚Çπ${d.expected_cash.toFixed(0)}`; } catch (e) { }
    }

    async function toggleSafety() {
      safetyMode = !safetyMode;
      document.getElementById('safetyToggle').classList.toggle('active', safetyMode);
      document.getElementById('togLabel').textContent = safetyMode ? 'MAINTENANCE ON' : 'MAINTENANCE';
      showToast(safetyMode ? 'üîß Maintenance Mode ACTIVE.' : 'üõ°Ô∏è Monitoring Enabled.', safetyMode ? 'warning' : 'success');
      if (currentShiftId) fetch('http://127.0.0.1:8000/api/safety-logs/', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ shift: currentShiftId, action: safetyMode ? 'ON' : 'OFF' }) }).catch(() => { });
    }

    async function dayEnd() {
      const t = logs.filter(l => l.type === 'cash').reduce((a, l) => a + l.amount, 0);
      await syncEventToBackend('NO_SALE', 0, 'DAY END ‚Äî Final Count');
      showToast(`üìä Day End: Cash Total ‚Çπ${t.toFixed(2)} ‚Äî Report sent.`, 'info');
      addLog('nosale', 0, 'DAY END ‚Äî Final Count');
    }

    function lockTerminal() {
      if (confirm('Lock terminal? A supervisor PIN will be required to unlock.')) {
        document.body.style.filter = 'blur(8px) brightness(0.5)';
        setTimeout(() => { const p = prompt('Enter supervisor PIN:'); document.body.style.filter = ''; showToast(p === '1234' ? 'üîì Terminal unlocked' : '‚ùå Incorrect PIN.', p === '1234' ? 'success' : 'error'); }, 200);
      }
    }

    renderItems(); renderLogs(); checkActiveShift();
  </script>
</body>

</html>