<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº—é“ºç›—çªƒè¡Œä¸ºç›‘æµ‹ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- æ·»åŠ Bootstrapå›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 20px;
            font-family: Arial, sans-serif;
        }
        .main-container {
            max-width: 1280px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .upload-container {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px 20px;
            text-align: center;
            background-color: #f9f9f9;
            transition: all 0.3s ease;
        }
        .upload-container:hover {
            border-color: #007bff;
            background-color: #f0f7ff;
        }
        .upload-icon {
            font-size: 3rem;
            color: #007bff;
            margin-bottom: 15px;
        }
        .file-requirements {
            margin-top: 20px;
            color: #6c757d;
        }
        .alert {
            margin-top: 20px;
        }
        .feature-box {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }
        .feature-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .feature-icon {
            font-size: 2rem;
            color: #0d6efd;
            margin-bottom: 15px;
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            background-color: #000;
            border-radius: 5px;
        }
        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .image-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .behavior-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .behavior-tag {
            display: inline-block;
            padding: 3px 8px;
            margin-right: 5px;
            margin-bottom: 5px;
            border-radius: 12px;
            background-color: #f8d7da;
            color: #721c24;
            font-size: 0.8rem;
        }
        .control-panel {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .results-container {
            display: none;
        }
        .nav-tabs .nav-link {
            font-weight: 600;
        }
        .status-indicator {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .status-green {
            background-color: #28a745;
        }
        .status-red {
            background-color: #dc3545;
        }
        .status-yellow {
            background-color: #ffc107;
        }
        /* è§†é¢‘æ§åˆ¶æ ·å¼ */
        .video-controls {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 0 0 5px 5px;
        }
        #videoProgress {
            cursor: pointer;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        #videoProgressBar {
            transition: width 0.1s linear;
        }
        #timeDisplay {
            font-family: monospace;
            font-size: 0.9rem;
            width: 110px;
            text-align: right;
        }
        #playPauseBtn {
            width: 80px;
        }
        .behavior-count {
            font-size: 24px;
            font-weight: bold;
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container main-container">
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h1 class="display-4">åº—é“ºç›—çªƒè¡Œä¸ºç›‘æµ‹ç³»ç»Ÿ</h1>
                <p class="lead">ä½¿ç”¨å…ˆè¿›çš„äººå·¥æ™ºèƒ½æŠ€æœ¯è¯†åˆ«å›¾ç‰‡å’Œè§†é¢‘ä¸­çš„å¯ç–‘ç›—çªƒè¡Œä¸º</p>
            </div>
        </div>

        <!-- è­¦å‘Šæ¶ˆæ¯ -->
        <div class="row mb-4">
            <div class="col-12">
                <div id="alerts-container">
                    {% with messages = get_flashed_messages() %}
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹tabs -->
        <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload-content" type="button" role="tab" aria-controls="upload-content" aria-selected="true">ä¸Šä¼ æ–‡ä»¶</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="results-tab" data-bs-toggle="tab" data-bs-target="#results-content" type="button" role="tab" aria-controls="results-content" aria-selected="false">æ£€æµ‹ç»“æœ</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="features-tab" data-bs-toggle="tab" data-bs-target="#features-content" type="button" role="tab" aria-controls="features-content" aria-selected="false">åŠŸèƒ½ä»‹ç»</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="about-tab" data-bs-toggle="tab" data-bs-target="#about-content" type="button" role="tab" aria-controls="about-content" aria-selected="false">å…³äºç³»ç»Ÿ</button>
            </li>
        </ul>

        <!-- Tabå†…å®¹ -->
        <div class="tab-content" id="mainTabsContent">
            <!-- ä¸Šä¼ æ–‡ä»¶å†…å®¹ -->
            <div class="tab-pane fade show active" id="upload-content" role="tabpanel" aria-labelledby="upload-tab">
                <div class="row">
                    <div class="col-md-8 mx-auto">
                        <div class="upload-container">
                            <div class="upload-icon">
                                <i class="bi bi-cloud-arrow-up"></i>ğŸ“¤
                            </div>
                            <h3>ä¸Šä¼ å›¾ç‰‡æˆ–è§†é¢‘æ–‡ä»¶</h3>
                            <p>æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                            
                            <div class="mb-3">
                                <input class="form-control" type="file" id="file" name="file" accept=".jpg,.jpeg,.png,.mp4,.avi,.mov" style="display: none;">
                                <button type="button" class="btn btn-primary" id="select-file-btn">é€‰æ‹©æ–‡ä»¶</button>
                            </div>
                            <div id="file-info" class="mb-3" style="display: none;">
                                <span id="file-name"></span>
                                <button type="button" class="btn btn-sm btn-outline-danger" id="clear-file-btn">æ¸…é™¤</button>
                            </div>
                            <div>
                                <button type="button" class="btn btn-success" id="upload-btn" disabled>å¼€å§‹åˆ†æ</button>
                            </div>
                            
                            <div class="file-requirements mt-3">
                                <small>æ”¯æŒçš„æ ¼å¼: JPG, JPEG, PNG, MP4, AVI, MOV<br>
                                æœ€å¤§æ–‡ä»¶å¤§å°: 100MB</small>
                            </div>
                            
                            <!-- å¤„ç†è¿›åº¦ -->
                            <div id="processing-status" class="mt-4" style="display: none;">
                                <div class="progress mb-2">
                                    <div id="upload-progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <p id="processing-message">æ­£åœ¨å¤„ç†æ–‡ä»¶...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ£€æµ‹ç»“æœå†…å®¹ -->
            <div class="tab-pane fade" id="results-content" role="tabpanel" aria-labelledby="results-tab">
                <div class="row">
                    <div class="col-12">
                        <div class="alert alert-info" id="no-results-message">
                            è¯·å…ˆä¸Šä¼ å¹¶å¤„ç†å›¾ç‰‡æˆ–è§†é¢‘ä»¥æŸ¥çœ‹ç»“æœ
                        </div>
                    </div>
                </div>
                
                <!-- æ£€æµ‹ç»“æœåŒºåŸŸ -->
                <div class="results-container" id="results-area">
                    <div class="row">
                        <div class="col-12">
                            <div class="control-panel mb-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h4 class="mb-0" id="result-title">åˆ†æç»“æœ</h4>
                                    <div>
                                        <a href="#" class="btn btn-sm btn-outline-primary" id="refresh-result-btn">åˆ·æ–°ç»“æœ</a>
                                        <a href="/" class="btn btn-sm btn-outline-danger">æ–°åˆ†æ</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å›¾åƒç»“æœ -->
                    <div id="image-result-container" class="results-container">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">åŸå§‹å›¾åƒ</div>
                                    <div class="card-body p-0">
                                        <div class="image-container">
                                            <img id="original-image" src="" alt="åŸå§‹å›¾åƒ">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">æ£€æµ‹ç»“æœ</div>
                                    <div class="card-body p-0">
                                        <div class="image-container">
                                            <img id="result-image" src="" alt="æ£€æµ‹ç»“æœ">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">æ£€æµ‹åˆ°çš„è¡Œä¸º</div>
                                    <div class="card-body">
                                        <div id="image-behaviors-container">
                                            <!-- è¡Œä¸ºåˆ—è¡¨å°†åŠ¨æ€æ·»åŠ  -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è§†é¢‘ç»“æœ -->
                    <div id="video-result-container" style="display: none;">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card mb-4">
                                    <div class="card-header bg-dark text-white">
                                        <h5 class="card-title mb-0">åˆ†æç»“æœè§†é¢‘</h5>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="video-container">
                                            <video id="result-video" class="w-100" controls preload="auto" playsinline>
                                                <source src="" type="video/mp4">
                                                <source src="" type="video/avi">
                                                <source src="" type="video/x-msvideo">
                                                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
                                            </video>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- è¡Œä¸ºåˆ—è¡¨ -->
                                <div class="card">
                                    <div class="card-header bg-dark text-white">
                                        <h5 class="card-title mb-0">å¯ç–‘è¡Œä¸ºåˆ—è¡¨</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="behavior-list" id="video-behaviors-container">
                                            <table class="table table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>æ—¶é—´ç‚¹</th>
                                                        <th>è¡Œä¸ºç±»å‹</th>
                                                        <th>ç½®ä¿¡åº¦</th>
                                                        <th>æ“ä½œ</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="video-behaviors-table">
                                                    <!-- è¡Œä¸ºè¡¨æ ¼è¡Œå°†åŠ¨æ€æ·»åŠ  -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- å³ä¾§ç»“æœæ‘˜è¦éƒ¨åˆ† -->
                            <div class="col-md-4">
                                <div class="card mb-4">
                                    <div class="card-header bg-danger text-white">
                                        <h5 class="card-title mb-0">æ£€æµ‹æ‘˜è¦</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-6 text-center">
                                                <div class="behavior-count" id="behaviors-count">0</div>
                                                <div>å¯ç–‘è¡Œä¸ºæ€»æ•°</div>
                                            </div>
                                            <div class="col-6 text-center">
                                                <div class="behavior-count" id="max-confidence">0%</div>
                                                <div>æœ€é«˜ç½®ä¿¡åº¦</div>
                                            </div>
                                        </div>
                                        
                                        <hr>
                                        
                                        <h6>æ£€æµ‹åˆ°çš„è¡Œä¸ºç±»å‹:</h6>
                                        <div id="behavior-types-container">
                                            <!-- è¡Œä¸ºç±»å‹æ ‡ç­¾å°†åŠ¨æ€æ·»åŠ  -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div class="card-header bg-dark text-white">
                                        <h5 class="card-title mb-0">åŸå§‹è§†é¢‘</h5>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="video-container">
                                            <video id="original-video" controls preload="auto" playsinline>
                                                <source src="" type="video/mp4">
                                                <source src="" type="video/avi">
                                                <source src="" type="video/x-msvideo">
                                                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
                                            </video>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åŠŸèƒ½ä»‹ç»å†…å®¹ -->
            <div class="tab-pane fade" id="features-content" role="tabpanel" aria-labelledby="features-tab">
                <div class="row mb-4">
                    <div class="col-12 text-center">
                        <h2 class="mb-4">å¯æ£€æµ‹çš„å¯ç–‘è¡Œä¸ºç‰¹å¾</h2>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-box">
                            <div class="feature-icon">ğŸ§¥</div>
                            <h4>é®æŒ¡ç±»è¡Œä¸º</h4>
                            <ul>
                                <li>ç”¨å¤–å¥—/é›¨ä¼é®æŒ¡å•†å“åŒºåŸŸ</li>
                                <li>åå¤è°ƒæ•´æ‰‹æè¢‹/å©´å„¿ä½ç½®</li>
                                <li>èƒŒå¯¹æ‘„åƒå¤´æ•´ç†åŒ…å†…ç‰©å“</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-box">
                            <div class="feature-icon">ğŸ‘€</div>
                            <h4>å§¿æ€å’Œè½¨è¿¹å¼‚å¸¸</h4>
                            <ul>
                                <li>åŒä¸€è´§æ¶å‰åå¤æŠ˜è¿”</li>
                                <li>æ‰‹è‚˜å†…æ”¶è§’åº¦å¼‚å¸¸</li>
                                <li>è‚©éƒ¨ä¸è‡ªç„¶éš†èµ·</li>
                                <li>çªç„¶è¹²ä¸‹ä¼´éšæ‰‹è‡‚åç¼©</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-box">
                            <div class="feature-icon">ğŸ“¦</div>
                            <h4>å•†å“å¤„ç†å¼‚å¸¸</h4>
                            <ul>
                                <li>æ’•æ ‡ç­¾åŠ¨ä½œ</li>
                                <li>æ‹†åŒ…è£…æŠ–åŠ¨</li>
                                <li>ç©ºç›’å¤åŸ</li>
                                <li>å¿«é€Ÿè—åŒ¿ç‰©å“</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                æ£€æµ‹ç³»ç»Ÿè¯´æ˜
                            </div>
                            <div class="card-body">
                                <p>æœ¬ç³»ç»Ÿä½¿ç”¨äººå·¥æ™ºèƒ½æŠ€æœ¯å®æ—¶æ£€æµ‹åº—é“ºä¸­çš„å¯ç–‘ç›—çªƒè¡Œä¸ºï¼Œç»“åˆYOLOv8ç›®æ ‡æ£€æµ‹ä¸è¡Œä¸ºåˆ†æç®—æ³•ï¼Œå¯ä»¥ç²¾ç¡®è¯†åˆ«å¤šç§å¸¸è§çš„ç›—çªƒè¡Œä¸ºæ¨¡å¼ã€‚</p>
                                <p>ç³»ç»Ÿæ”¯æŒä»¥ä¸‹åŠŸèƒ½ï¼š</p>
                                <ul>
                                    <li>å›¾åƒåˆ†æ - å¯¹å•å¸§å›¾åƒè¿›è¡Œç›—çªƒè¡Œä¸ºæ£€æµ‹</li>
                                    <li>è§†é¢‘åˆ†æ - å¯¹è§†é¢‘è¿›è¡Œè¿ç»­å¸§æ£€æµ‹ï¼Œè¿½è¸ªå¯ç–‘è¡Œä¸ºæ—¶é—´çº¿</li>
                                    <li>å¤šç±»å‹è¡Œä¸ºè¯†åˆ« - å¯è¯†åˆ«å¤šç§ä¸åŒç±»å‹çš„å¯ç–‘è¡Œä¸º</li>
                                    <li>è¡Œä¸ºæ¦‚ç‡è¯„ä¼° - ä¸ºæ¯ç§æ£€æµ‹åˆ°çš„è¡Œä¸ºæä¾›å¯ä¿¡åº¦è¯„åˆ†</li>
                                </ul>
                                <p>æ‰€æœ‰åˆ†æç»“æœå‡å¯å¯¼å‡ºï¼ŒåŒ…æ‹¬å¸¦æœ‰æ ‡æ³¨çš„å›¾åƒå’Œè§†é¢‘ï¼Œä»¥åŠå¯ç–‘è¡Œä¸ºçš„è¯¦ç»†æ—¶é—´æˆ³å’Œæè¿°ã€‚</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å…³äºç³»ç»Ÿå†…å®¹ -->
            <div class="tab-pane fade" id="about-content" role="tabpanel" aria-labelledby="about-tab">
                <div class="row mb-5">
                    <div class="col-12 text-center">
                        <h2 class="display-5">å…³äºç³»ç»Ÿ</h2>
                        <p class="lead">åº—é“ºç›—çªƒè¡Œä¸ºç›‘æµ‹ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºAIçš„å®‰é˜²å·¥å…·ï¼Œèƒ½å¤Ÿè¯†åˆ«å›¾åƒå’Œè§†é¢‘ä¸­çš„å¯ç–‘ç›—çªƒè¡Œä¸ºç‰¹å¾</p>
                    </div>
                </div>

                <!-- ä¸»è¦å†…å®¹ -->
                <div class="row mb-5">
                    <div class="col-lg-10 mx-auto">
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h4 class="mb-0">ç³»ç»Ÿæ¦‚è¿°</h4>
                            </div>
                            <div class="card-body">
                                <p>æœ¬ç³»ç»Ÿç»“åˆäº†å…ˆè¿›çš„è®¡ç®—æœºè§†è§‰æŠ€æœ¯å’Œä¸“ä¸šçš„ç›—çªƒè¡Œä¸ºåˆ†æï¼Œæ—¨åœ¨å¸®åŠ©é›¶å”®å•†åº—ã€è¶…å¸‚å’Œå•†åœºæé«˜å®‰å…¨æ°´å¹³ï¼Œå‡å°‘å•†å“æŸå¤±ã€‚</p>
                                <p>ç³»ç»Ÿå¯ä»¥åˆ†æé™æ€å›¾åƒå’Œè§†é¢‘å½•åƒï¼Œè‡ªåŠ¨è¯†åˆ«å‡ºå¤šç§å¯ç–‘çš„ç›—çªƒè¡Œä¸ºç‰¹å¾ï¼ŒåŒ…æ‹¬é®æŒ¡ç±»åŠ¨ä½œã€è½¨è¿¹å¼‚å¸¸ã€å§¿æ€å¼‚å¸¸å’Œå•†å“å¤„ç†å¼‚å¸¸ç­‰ã€‚</p>
                                <p>ç³»ç»Ÿæ”¯æŒä¸¤ç§è¿è¡Œæ¨¡å¼ï¼š</p>
                                <ul>
                                    <li><strong>çª—ä½“åº”ç”¨æ¨¡å¼</strong>ï¼šä»¥æ¡Œé¢åº”ç”¨å½¢å¼è¿è¡Œï¼Œé€‚åˆç¦»çº¿ä½¿ç”¨</li>
                                    <li><strong>Webåº”ç”¨æ¨¡å¼</strong>ï¼šä»¥ç½‘é¡µå½¢å¼è¿è¡Œï¼Œé€‚åˆå¤šäººåä½œä½¿ç”¨</li>
                                </ul>
                            </div>
                        </div>

                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h4 class="mb-0">ä¸»è¦åŠŸèƒ½</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5>å›¾åƒåˆ†æåŠŸèƒ½</h5>
                                        <ul>
                                            <li>äººç‰©ã€ç‰©å“æ£€æµ‹ä¸åˆ†ç±»</li>
                                            <li>é®æŒ¡è¡Œä¸ºæ£€æµ‹ï¼ˆç”¨è¡£ç‰©é®æŒ¡ç­‰ï¼‰</li>
                                            <li>å§¿æ€å¼‚å¸¸æ£€æµ‹ï¼ˆæ‰‹è‚˜å†…æ”¶ç­‰ï¼‰</li>
                                            <li>å•†å“å¤„ç†å¼‚å¸¸æ£€æµ‹ï¼ˆæ’•æ ‡ç­¾ç­‰ï¼‰</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>è§†é¢‘åˆ†æåŠŸèƒ½</h5>
                                        <ul>
                                            <li>äººç‰©è·Ÿè¸ªä¸è½¨è¿¹åˆ†æ</li>
                                            <li>å•†å“äº¤äº’è¡Œä¸ºåˆ†æ</li>
                                            <li>æ—¶åºè¡Œä¸ºæ¨¡å¼è¯†åˆ«</li>
                                            <li>å¯ç–‘è¡Œä¸ºæ ‡è®°ä¸æ—¶é—´è½´å±•ç¤º</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h4 class="mb-0">æŠ€æœ¯å®ç°</h4>
                            </div>
                            <div class="card-body">
                                <div class="mb-4 text-center">
                                    <span class="badge bg-primary p-2 m-1">YOLOv11n</span>
                                    <span class="badge bg-primary p-2 m-1">PyTorch</span>
                                    <span class="badge bg-primary p-2 m-1">OpenCV</span>
                                    <span class="badge bg-primary p-2 m-1">Flask</span>
                                    <span class="badge bg-primary p-2 m-1">Tkinter</span>
                                    <span class="badge bg-primary p-2 m-1">Ultralytics</span>
                                    <span class="badge bg-primary p-2 m-1">è®¡ç®—æœºè§†è§‰</span>
                                    <span class="badge bg-primary p-2 m-1">è¡Œä¸ºåˆ†æ</span>
                                </div>
                                <p>æœ¬ç³»ç»Ÿåˆ©ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹YOLOv11nè¿›è¡Œç‰©ä½“æ£€æµ‹ï¼Œç»“åˆè‡ªå®šä¹‰çš„è¡Œä¸ºåˆ†æç®—æ³•è¯†åˆ«å¯ç–‘ç›—çªƒè¡Œä¸ºç‰¹å¾ã€‚ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†å›¾åƒå’Œè§†é¢‘çš„å¤„ç†é€»è¾‘åˆ†ç¦»ï¼Œæ—¢æé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ï¼Œåˆä¿è¯äº†åŠŸèƒ½çš„å®Œæ•´æ€§ã€‚</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h4 class="mb-0">ä½¿ç”¨è¯´æ˜</h4>
                            </div>
                            <div class="card-body">
                                <h5>è¿è¡Œç³»ç»Ÿ</h5>
                                <div class="bg-light p-3 rounded mb-3">
                                    <code>
                                        # ä»¥çª—ä½“æ¨¡å¼è¿è¡Œï¼ˆé»˜è®¤ï¼‰<br>
                                        python run.py<br><br>
                                        # ä»¥Webæ¨¡å¼è¿è¡Œ<br>
                                        python run.py --web<br><br>
                                        # æ˜¾å¼æŒ‡å®šçª—ä½“æ¨¡å¼<br>
                                        python run.py --gui
                                    </code>
                                </div>
                                <p>å¦‚éœ€äº†è§£æ›´å¤šè¯¦ç»†ä½¿ç”¨è¯´æ˜ï¼Œè¯·å‚é˜…é¡¹ç›®ä¸­çš„README.mdæ–‡ä»¶ã€‚</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é¡µè„š -->
                <footer class="mt-5 text-center text-muted">
                    <p>åº—é“ºç›—çªƒè¡Œä¸ºç›‘æµ‹ç³»ç»Ÿ &copy; 2025</p>
                </footer>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // æ–‡ä»¶ä¸Šä¼ ç›¸å…³
            const fileInput = document.getElementById('file');
            const selectFileBtn = document.getElementById('select-file-btn');
            const clearFileBtn = document.getElementById('clear-file-btn');
            const fileInfo = document.getElementById('file-info');
            const fileName = document.getElementById('file-name');
            const uploadBtn = document.getElementById('upload-btn');
            const processingStatus = document.getElementById('processing-status');
            const processingMessage = document.getElementById('processing-message');
            const uploadProgressBar = document.getElementById('upload-progress-bar');
            
            // Tabåˆ‡æ¢ç›¸å…³
            const resultTab = document.getElementById('results-tab');
            
            // å­˜å‚¨å½“å‰å¤„ç†ç»“æœæ•°æ®
            let currentResultData = null;
            
            // åˆ·æ–°æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('refresh-result-btn').addEventListener('click', function(e) {
                e.preventDefault();
                if (currentResultData && currentResultData.type === 'video') {
                    // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
                    const resultVideoContainer = document.querySelector('.video-container:first-child');
                    
                    // æ·»åŠ åŠ è½½æŒ‡ç¤ºå™¨
                    const loadingIndicator = document.createElement('div');
                    loadingIndicator.className = 'position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center bg-dark bg-opacity-50';
                    loadingIndicator.innerHTML = '<div class="spinner-border text-light" role="status"><span class="visually-hidden">Loading...</span></div>';
                    resultVideoContainer.appendChild(loadingIndicator);
                    
                    // è·å–å½“å‰æ—¶é—´æˆ³
                    const timestamp = new Date().getTime();
                    
                    // ç›´æ¥è·å–è§†é¢‘å…ƒç´ 
                    const resultVideo = document.getElementById('result-video');
                    const originalVideo = document.getElementById('original-video');
                    
                    console.log("åˆ·æ–°å‰çš„åŸå§‹è§†é¢‘åœ°å€:", originalVideo.querySelector('source').src);
                    console.log("åˆ·æ–°å‰çš„ç»“æœè§†é¢‘åœ°å€:", resultVideo.querySelector('source').src);
                    
                    // æš‚å­˜æ’­æ”¾çŠ¶æ€
                    const wasPlaying = !resultVideo.paused;
                    const currentTime = resultVideo.currentTime;
                    
                    // ç›´æ¥æ›´æ–°è§†é¢‘URLè€Œä¸æ˜¯é‡å»ºè§†é¢‘å…ƒç´ 
                    Array.from(resultVideo.querySelectorAll('source')).forEach(source => {
                        let baseUrl = currentResultData.result;
                        if (baseUrl) {
                            // ç§»é™¤æ—§çš„æŸ¥è¯¢å‚æ•°
                            baseUrl = baseUrl.split('?')[0];
                            source.src = baseUrl + '?t=' + timestamp;
                        }
                    });
                    
                    Array.from(originalVideo.querySelectorAll('source')).forEach(source => {
                        let baseUrl = currentResultData.original;
                        if (baseUrl) {
                            // ç§»é™¤æ—§çš„æŸ¥è¯¢å‚æ•°
                            baseUrl = baseUrl.split('?')[0];
                            source.src = baseUrl + '?t=' + timestamp;
                        }
                    });
                    
                    // æ‰“å°æ›´æ–°åçš„åœ°å€
                    console.log("åˆ·æ–°åçš„åŸå§‹è§†é¢‘åœ°å€:", originalVideo.querySelector('source').src);
                    console.log("åˆ·æ–°åçš„ç»“æœè§†é¢‘åœ°å€:", resultVideo.querySelector('source').src);
                    
                    // åŠ è½½è§†é¢‘
                    resultVideo.load();
                    originalVideo.load();
                    
                    // æ·»åŠ è°ƒè¯•ä¿¡æ¯ - æ‰“å°è§†é¢‘å…ƒç´ çš„srcå±æ€§
                    console.log("åŸå§‹è§†é¢‘å…ƒç´ sources:", Array.from(originalVideo.querySelectorAll('source')).map(s => s.src));
                    console.log("ç»“æœè§†é¢‘å…ƒç´ sources:", Array.from(resultVideo.querySelectorAll('source')).map(s => s.src));
                    
                    // è®¾ç½®åŠ è½½å®Œæˆåæ¢å¤æ’­æ”¾
                    if (wasPlaying) {
                        resultVideo.oncanplay = function() {
                            resultVideo.currentTime = currentTime;
                            resultVideo.play();
                            resultVideo.oncanplay = null;
                        };
                    }
                    
                    // ç§»é™¤åŠ è½½æŒ‡ç¤ºå™¨
                    setTimeout(() => {
                        if (loadingIndicator.parentNode) {
                            loadingIndicator.remove();
                        }
                    }, 1000);
                }
            });
            
            // åŠ è½½ç¤ºä¾‹æ–‡ä»¶
            loadExamples();
            
            // é€‰æ‹©æ–‡ä»¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            selectFileBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            // æ–‡ä»¶é€‰æ‹©æ”¹å˜äº‹ä»¶
            fileInput.addEventListener('change', function() {
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    fileName.textContent = file.name;
                    fileInfo.style.display = 'block';
                    uploadBtn.disabled = false;
                } else {
                    fileInfo.style.display = 'none';
                    uploadBtn.disabled = true;
                }
            });
            
            // æ¸…é™¤æ–‡ä»¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            clearFileBtn.addEventListener('click', function() {
                fileInput.value = '';
                fileInfo.style.display = 'none';
                uploadBtn.disabled = true;
            });
            
            // å¼€å§‹åˆ†ææŒ‰é’®ç‚¹å‡»äº‹ä»¶
            uploadBtn.addEventListener('click', function() {
                if (fileInput.files.length === 0) return;
                
                const file = fileInput.files[0];
                uploadAndProcessFile(file);
            });
            
            // æ‹–æ”¾æ–‡ä»¶åŠŸèƒ½
            const uploadContainer = document.querySelector('.upload-container');
            
            uploadContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadContainer.style.borderColor = '#007bff';
                uploadContainer.style.backgroundColor = '#f0f7ff';
            });
            
            uploadContainer.addEventListener('dragleave', function() {
                uploadContainer.style.borderColor = '#ddd';
                uploadContainer.style.backgroundColor = '#f9f9fa';
            });
            
            uploadContainer.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadContainer.style.borderColor = '#ddd';
                uploadContainer.style.backgroundColor = '#f9f9fa';
                
                if (e.dataTransfer.files.length > 0) {
                    fileInput.files = e.dataTransfer.files;
                    const file = fileInput.files[0];
                    fileName.textContent = file.name;
                    fileInfo.style.display = 'block';
                    uploadBtn.disabled = false;
                }
            });
            
            // å¤„ç†ç¤ºä¾‹æ–‡ä»¶ç‚¹å‡»
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('example-item')) {
                    const exampleFilename = e.target.getAttribute('data-filename');
                    processExampleFile(exampleFilename);
                }
            });
            
            // å‡½æ•°ï¼šä¸Šä¼ å¹¶å¤„ç†æ–‡ä»¶
            function uploadAndProcessFile(file) {
                // æ˜¾ç¤ºå¤„ç†çŠ¶æ€
                processingStatus.style.display = 'block';
                processingMessage.textContent = 'æ­£åœ¨åˆ†ææ–‡ä»¶...';
                uploadProgressBar.style.width = '0%';
                
                const formData = new FormData();
                formData.append('file', file);
                
                // åˆ›å»º XHR è¯·æ±‚
                const xhr = new XMLHttpRequest();
                
                // ä¸Šä¼ è¿›åº¦ç›‘å¬
                xhr.upload.addEventListener('progress', function(e) {
                    if (e.lengthComputable) {
                        const percentComplete = Math.round((e.loaded / e.total) * 100);
                        uploadProgressBar.style.width = percentComplete + '%';
                        uploadProgressBar.setAttribute('aria-valuenow', percentComplete);
                    }
                });
                
                // è¯·æ±‚å®Œæˆäº‹ä»¶
                xhr.addEventListener('load', function() {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        // ä¸Šä¼ æˆåŠŸ
                        processingMessage.textContent = 'æ–‡ä»¶æ­£åœ¨å¤„ç†ä¸­...';
                        uploadProgressBar.style.width = '100%';
                        
                        try {
                            const result = JSON.parse(xhr.responseText);
                            showProcessingResult(result);
                        } catch (e) {
                            showProcessingError('å¤„ç†å“åº”å¤±è´¥: ' + e.message);
                        }
                    } else {
                        // ä¸Šä¼ å¤±è´¥
                        let errorMessage = 'ä¸Šä¼ å¤±è´¥';
                        try {
                            const response = JSON.parse(xhr.responseText);
                            if (response.error) {
                                errorMessage = response.error;
                            }
                        } catch (e) {
                            errorMessage = 'è¯·æ±‚é”™è¯¯: ' + xhr.status;
                        }
                        showProcessingError(errorMessage);
                    }
                });
                
                // è¯·æ±‚é”™è¯¯äº‹ä»¶
                xhr.addEventListener('error', function() {
                    showProcessingError('ç½‘ç»œé”™è¯¯ï¼Œä¸Šä¼ å¤±è´¥');
                });
                
                // å¼€å§‹ä¸Šä¼ 
                xhr.open('POST', '/upload');
                xhr.send(formData);
            }
            
            // å‡½æ•°ï¼šå¤„ç†ç¤ºä¾‹æ–‡ä»¶
            function processExampleFile(filename) {
                // æ˜¾ç¤ºå¤„ç†çŠ¶æ€
                processingStatus.style.display = 'block';
                processingMessage.textContent = 'æ­£åœ¨å¤„ç†ç¤ºä¾‹æ–‡ä»¶...';
                uploadProgressBar.style.width = '50%';
                
                // åˆ›å»º XHR è¯·æ±‚
                const xhr = new XMLHttpRequest();
                
                // è¯·æ±‚å®Œæˆäº‹ä»¶
                xhr.addEventListener('load', function() {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        // å¤„ç†æˆåŠŸ
                        uploadProgressBar.style.width = '100%';
                        
                        try {
                            const result = JSON.parse(xhr.responseText);
                            showProcessingResult(result);
                        } catch (e) {
                            showProcessingError('å¤„ç†å“åº”å¤±è´¥: ' + e.message);
                        }
                    } else {
                        // å¤„ç†å¤±è´¥
                        let errorMessage = 'å¤„ç†å¤±è´¥';
                        try {
                            const response = JSON.parse(xhr.responseText);
                            if (response.error) {
                                errorMessage = response.error;
                            }
                        } catch (e) {
                            errorMessage = 'è¯·æ±‚é”™è¯¯: ' + xhr.status;
                        }
                        showProcessingError(errorMessage);
                    }
                });
                
                // è¯·æ±‚é”™è¯¯äº‹ä»¶
                xhr.addEventListener('error', function() {
                    showProcessingError('ç½‘ç»œé”™è¯¯ï¼Œå¤„ç†å¤±è´¥');
                });
                
                // å¼€å§‹å¤„ç†
                xhr.open('POST', '/api/process_example/' + filename);
                xhr.send();
            }
            
            // å‡½æ•°ï¼šåŠ è½½ç¤ºä¾‹æ–‡ä»¶
            function loadExamples() {
                const examplesContainer = document.getElementById('examples-container');
                
                fetch('/api/examples')
                    .then(response => response.json())
                    .then(data => {
                        examplesContainer.innerHTML = '';
                        
                        // åˆ›å»ºç¤ºä¾‹æ–‡ä»¶å±•ç¤ºåŒº
                        const row = document.createElement('div');
                        row.className = 'row';
                        
                        // å›¾åƒç¤ºä¾‹
                        if (data.images && data.images.length > 0) {
                            const imageCol = document.createElement('div');
                            imageCol.className = 'col-md-6';
                            
                            const imageCard = document.createElement('div');
                            imageCard.className = 'card';
                            
                            const imageCardHeader = document.createElement('div');
                            imageCardHeader.className = 'card-header';
                            imageCardHeader.textContent = 'å›¾åƒç¤ºä¾‹';
                            
                            const imageCardBody = document.createElement('div');
                            imageCardBody.className = 'card-body';
                            
                            const imageList = document.createElement('div');
                            imageList.className = 'row row-cols-2 row-cols-md-3 g-2';
                            
                            data.images.forEach(image => {
                                const col = document.createElement('div');
                                col.className = 'col';
                                
                                const imageItem = document.createElement('div');
                                imageItem.className = 'card h-100 example-item';
                                imageItem.setAttribute('data-filename', image);
                                imageItem.style.cursor = 'pointer';
                                
                                const img = document.createElement('img');
                                img.src = '/static/examples/' + image;
                                img.className = 'card-img-top';
                                img.alt = image;
                                img.style.height = '100px';
                                img.style.objectFit = 'cover';
                                
                                const cardBody = document.createElement('div');
                                cardBody.className = 'card-body p-2';
                                
                                const cardTitle = document.createElement('p');
                                cardTitle.className = 'card-text small text-truncate';
                                cardTitle.textContent = image;
                                
                                cardBody.appendChild(cardTitle);
                                imageItem.appendChild(img);
                                imageItem.appendChild(cardBody);
                                col.appendChild(imageItem);
                                imageList.appendChild(col);
                            });
                            
                            imageCardBody.appendChild(imageList);
                            imageCard.appendChild(imageCardHeader);
                            imageCard.appendChild(imageCardBody);
                            imageCol.appendChild(imageCard);
                            row.appendChild(imageCol);
                        }
                        
                        // è§†é¢‘ç¤ºä¾‹
                        if (data.videos && data.videos.length > 0) {
                            const videoCol = document.createElement('div');
                            videoCol.className = 'col-md-6';
                            
                            const videoCard = document.createElement('div');
                            videoCard.className = 'card';
                            
                            const videoCardHeader = document.createElement('div');
                            videoCardHeader.className = 'card-header';
                            videoCardHeader.textContent = 'è§†é¢‘ç¤ºä¾‹';
                            
                            const videoCardBody = document.createElement('div');
                            videoCardBody.className = 'card-body';
                            
                            const videoList = document.createElement('div');
                            videoList.className = 'list-group';
                            
                            data.videos.forEach(video => {
                                const videoItem = document.createElement('a');
                                videoItem.href = '#';
                                videoItem.className = 'list-group-item list-group-item-action example-item';
                                videoItem.setAttribute('data-filename', video);
                                
                                const icon = document.createElement('i');
                                icon.className = 'bi bi-film me-2';
                                icon.textContent = 'ğŸ¬';
                                
                                videoItem.appendChild(icon);
                                videoItem.appendChild(document.createTextNode(video));
                                videoList.appendChild(videoItem);
                            });
                            
                            videoCardBody.appendChild(videoList);
                            videoCard.appendChild(videoCardHeader);
                            videoCard.appendChild(videoCardBody);
                            videoCol.appendChild(videoCard);
                            row.appendChild(videoCol);
                        }
                        
                        examplesContainer.appendChild(row);
                    })
                    .catch(error => {
                        examplesContainer.innerHTML = '<div class="alert alert-danger">åŠ è½½ç¤ºä¾‹æ–‡ä»¶å¤±è´¥: ' + error.message + '</div>';
                    });
            }
            
            // å‡½æ•°ï¼šæ˜¾ç¤ºå¤„ç†ç»“æœ
            function showProcessingResult(result) {
                // å­˜å‚¨ç»“æœæ•°æ®ä»¥ä¾¿åç»­åˆ·æ–°
                currentResultData = result;
                
                // éšè—å¤„ç†çŠ¶æ€
                processingStatus.style.display = 'none';
                
                // æ˜¾ç¤ºç»“æœtab
                resultTab.click();
                
                // éšè—"æ— ç»“æœ"æ¶ˆæ¯
                document.getElementById('no-results-message').style.display = 'none';
                // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                document.getElementById('results-area').style.display = 'block';
                
                // æ ¹æ®ç»“æœç±»å‹æ˜¾ç¤ºå¯¹åº”çš„ç»“æœ
                if (result.type === 'image') {
                    showImageResult(result);
                } else if (result.type === 'video') {
                    showVideoResult(result);
                }
            }
            
            // å‡½æ•°ï¼šæ˜¾ç¤ºå¤„ç†é”™è¯¯
            function showProcessingError(message) {
                processingStatus.style.display = 'block';
                processingMessage.innerHTML = '<div class="alert alert-danger">' + message + '</div>';
                uploadProgressBar.classList.remove('bg-primary');
                uploadProgressBar.classList.add('bg-danger');
            }
        });

        // æ˜¾ç¤ºå›¾åƒç»“æœ
        function showImageResult(data) {
            // è®¾ç½®å›¾åƒç»“æœå®¹å™¨æ˜¾ç¤º
            document.getElementById('image-result-container').style.display = 'block';
            document.getElementById('video-result-container').style.display = 'none';
            
            // è®¾ç½®å›¾åƒæº
            document.getElementById('original-image').src = data.original;
            document.getElementById('result-image').src = data.result;
            
            // è®¾ç½®è¡Œä¸ºåˆ—è¡¨
            const behaviorsContainer = document.getElementById('image-behaviors-container');
            behaviorsContainer.innerHTML = '';
            
            if (data.behaviors && data.behaviors.length > 0) {
                const list = document.createElement('ul');
                list.className = 'list-group';
                
                data.behaviors.forEach(behavior => {
                    const item = document.createElement('li');
                    item.className = 'list-group-item';
                    
                    const statusIndicator = document.createElement('span');
                    statusIndicator.className = 'status-indicator ' + 
                        (behavior.confidence > 0.7 ? 'status-red' : 
                         behavior.confidence > 0.4 ? 'status-yellow' : 'status-green');
                    
                    item.appendChild(statusIndicator);
                    item.appendChild(document.createTextNode(
                        `${behavior.type}: ${behavior.description} (å¯ä¿¡åº¦: ${(behavior.confidence * 100).toFixed(1)}%)`
                    ));
                    
                    list.appendChild(item);
                });
                
                behaviorsContainer.appendChild(list);
            } else {
                behaviorsContainer.innerHTML = '<div class="alert alert-info">æœªæ£€æµ‹åˆ°å¯ç–‘è¡Œä¸º</div>';
            }
        }

        // æ˜¾ç¤ºè§†é¢‘ç»“æœ
        function showVideoResult(data) {
            console.log("è§†é¢‘ç»“æœæ•°æ®:", data);  // æ·»åŠ è°ƒè¯•ä¿¡æ¯
            console.log("åŸå§‹è§†é¢‘è·¯å¾„:", data.original);  // æ·»åŠ è°ƒè¯•ä¿¡æ¯
            console.log("ç»“æœè§†é¢‘è·¯å¾„:", data.result);  // æ·»åŠ è°ƒè¯•ä¿¡æ¯
            
            // æ ‡å‡†åŒ–è·¯å¾„æ ¼å¼ - ç»Ÿä¸€ä½¿ç”¨æ­£æ–œæ 
            if (data.result) {
                data.result = data.result.replace(/\\/g, '/');
                // ç¡®ä¿æœ‰å‰å¯¼æ–œæ 
                if (!data.result.startsWith('/')) {
                    data.result = '/' + data.result;
                }
                console.log("æ ‡å‡†åŒ–åçš„ç»“æœè§†é¢‘è·¯å¾„:", data.result);
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯uploadsç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¦‚æœæ˜¯åˆ™ä½¿ç”¨web-videoè·¯ç”±
                if (data.result.includes('/static/uploads/')) {
                    // è·å–æ–‡ä»¶å
                    let filename = data.result.split('/').pop();
                    // è½¬æ¢ä¸ºweb-videoè·¯ç”±
                    data.web_result = `/web-video/${filename}`;
                    console.log("Webè§†é¢‘è·¯å¾„:", data.web_result);
                }
            }
            
            if (data.original) {
                data.original = data.original.replace(/\\/g, '/');
                // ç¡®ä¿æœ‰å‰å¯¼æ–œæ 
                if (!data.original.startsWith('/')) {
                    data.original = '/' + data.original;
                }
                console.log("æ ‡å‡†åŒ–åçš„åŸå§‹è§†é¢‘è·¯å¾„:", data.original);
            }
            
            // éªŒè¯è§†é¢‘è·¯å¾„
            if (!data.result) {
                console.error("ç»“æœè§†é¢‘è·¯å¾„æ— æ•ˆ");
                // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                const errorContainer = document.createElement('div');
                errorContainer.className = 'alert alert-danger mt-3';
                errorContainer.textContent = 'ç»“æœè§†é¢‘è·¯å¾„æ— æ•ˆï¼Œæ— æ³•æ’­æ”¾è§†é¢‘';
                document.getElementById('video-result-container').appendChild(errorContainer);
                
                // è®¾ç½®è¶…æ—¶è‡ªåŠ¨ç§»é™¤é”™è¯¯æ¶ˆæ¯
                setTimeout(() => {
                    if (errorContainer.parentNode) {
                        errorContainer.remove();
                    }
                }, 5000);
                return;
            }
            
            // è®¾ç½®è§†é¢‘ç»“æœå®¹å™¨æ˜¾ç¤º
            document.getElementById('image-result-container').style.display = 'none';
            document.getElementById('video-result-container').style.display = 'block';
            
            // è®¾ç½®è§†é¢‘æº
            const originalVideo = document.getElementById('original-video');
            const resultVideo = document.getElementById('result-video');
            
            // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ä»¥é¿å…é‡å¤æ·»åŠ 
            const oldErrorHandler = resultVideo.onerror;
            const oldLoadedHandler = resultVideo.onloadeddata;
            resultVideo.onerror = null;
            resultVideo.onloadeddata = null;
            
            // æ¸…é™¤ç°æœ‰æº
            originalVideo.innerHTML = '';
            resultVideo.innerHTML = '';
            
            // ç§»é™¤ä»»ä½•ç°æœ‰çš„é”™è¯¯æ¶ˆæ¯
            const existingErrorMsg = resultVideo.parentNode.querySelector('.alert');
            if (existingErrorMsg) existingErrorMsg.remove();
            
            // æ·»åŠ æ—¶é—´æˆ³é¿å…ç¼“å­˜é—®é¢˜
            const timestamp = new Date().getTime();
            
            // æ·»åŠ MP4æºï¼ˆä¼˜å…ˆï¼‰
            const originalMp4Source = document.createElement('source');
            originalMp4Source.src = data.original + '?t=' + timestamp;
            originalMp4Source.type = 'video/mp4';
            originalVideo.appendChild(originalMp4Source);
            
            const resultMp4Source = document.createElement('source');
            // ä¼˜å…ˆä½¿ç”¨web-videoè·¯ç”±å¤„ç†åçš„è§†é¢‘
            resultMp4Source.src = (data.web_result || data.result) + '?t=' + timestamp;
            resultMp4Source.type = 'video/mp4';
            resultVideo.appendChild(resultMp4Source);
            
            // æ·»åŠ AVIæºï¼ˆå¤‡ç”¨ï¼‰
            const originalAviSource = document.createElement('source');
            originalAviSource.src = data.original + '?t=' + timestamp;
            originalAviSource.type = 'video/avi';
            originalVideo.appendChild(originalAviSource);
            
            const resultAviSource = document.createElement('source');
            resultAviSource.src = data.result + '?t=' + timestamp;
            resultAviSource.type = 'video/avi';
            resultVideo.appendChild(resultAviSource);
            
            // æ·»åŠ X-MSVideoæºï¼ˆå¦ä¸€ç§AVIè¯†åˆ«æ–¹å¼ï¼‰
            const originalMSVideoSource = document.createElement('source');
            originalMSVideoSource.src = data.original + '?t=' + timestamp;
            originalMSVideoSource.type = 'video/x-msvideo';
            originalVideo.appendChild(originalMSVideoSource);
            
            const resultMSVideoSource = document.createElement('source');
            resultMSVideoSource.src = data.result + '?t=' + timestamp;
            resultMSVideoSource.type = 'video/x-msvideo';
            resultVideo.appendChild(resultMSVideoSource);
            
            // åŠ è½½è§†é¢‘
            originalVideo.load();
            resultVideo.load();
            
            // æ·»åŠ ç‰¹å®šé”™è¯¯å¤„ç†
            resultVideo.onerror = function(e) {
                console.error('è§†é¢‘åŠ è½½é”™è¯¯äº‹ä»¶:', e);
                console.error('è§†é¢‘åŠ è½½é”™è¯¯è¯¦æƒ…:', resultVideo.error);
                console.error('é”™è¯¯ä»£ç :', resultVideo.error ? resultVideo.error.code : 'unknown');
                console.error('é”™è¯¯æ¶ˆæ¯:', resultVideo.error ? resultVideo.error.message : 'unknown');
                
                // ç§»é™¤ä»»ä½•ç°æœ‰çš„é”™è¯¯æ¶ˆæ¯
                const existingErrorMsg = resultVideo.parentNode.querySelector('.alert');
                if (existingErrorMsg) existingErrorMsg.remove();
                
                // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                const errorMsg = document.createElement('div');
                errorMsg.className = 'alert alert-warning text-center mt-2';
                errorMsg.innerHTML = 'è§†é¢‘åŠ è½½å¤±è´¥ï¼Œæ­£åœ¨å°è¯•ç›´æ¥è®¿é—®è§†é¢‘æ–‡ä»¶...';
                resultVideo.parentNode.appendChild(errorMsg);
                
                // å°è¯•ç›´æ¥è®¿é—®è§†é¢‘ï¼Œä½¿ç”¨å¤šç§å¯èƒ½çš„URLæ ¼å¼
                setTimeout(() => {
                    try {
                        // è·å–æ–‡ä»¶å
                        const filename = data.result.split('/').pop();
                        
                        // ç”Ÿæˆå¯èƒ½çš„URLåˆ—è¡¨
                        const possibleUrls = [
                            data.result + '?t=' + new Date().getTime(),
                            '/static/output/' + filename + '?t=' + new Date().getTime(),
                            `/video/${filename}?t=` + new Date().getTime()
                        ];
                        
                        console.log("å°è¯•ä»¥ä¸‹URLåˆ—è¡¨:", possibleUrls);
                        
                        // åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰å¯èƒ½URLçš„é“¾æ¥åˆ—è¡¨
                        let linkHtml = '<div class="mt-3 mb-3">å°è¯•ç›´æ¥è®¿é—®ä»¥ä¸‹é“¾æ¥:</div><ul class="list-group">';
                        possibleUrls.forEach(url => {
                            linkHtml += `<li class="list-group-item"><a href="${url}" target="_blank">${url.split('?')[0]}</a></li>`;
                        });
                        linkHtml += '</ul>';
                        
                        errorMsg.innerHTML = linkHtml;
                        
                        // è‡ªåŠ¨å°è¯•ç¬¬ä¸€ä¸ªURL
                        const iframe = document.createElement('iframe');
                        iframe.src = possibleUrls[0];
                        iframe.className = "w-100 h-100 position-absolute top-0 start-0";
                        iframe.style.border = "none";
                        resultVideo.parentNode.appendChild(iframe);
                    } catch (err) {
                        console.error("å¤„ç†è§†é¢‘é“¾æ¥å¤±è´¥:", err);
                        errorMsg.innerHTML = 'æ— æ³•åŠ è½½è§†é¢‘ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ã€‚';
                    }
                }, 2000);
            };
            
            // æ·»åŠ è§†é¢‘åŠ è½½æˆåŠŸäº‹ä»¶å¤„ç†
            resultVideo.onloadeddata = function() {
                console.log('è§†é¢‘åŠ è½½æˆåŠŸ');
                // ç§»é™¤ä»»ä½•é”™è¯¯æ¶ˆæ¯
                const errorMsg = resultVideo.parentNode.querySelector('.alert');
                if (errorMsg) errorMsg.remove();
            };
            
            // æ·»åŠ è°ƒè¯•ä¿¡æ¯
            console.log("åŸå§‹è§†é¢‘å…ƒç´ sources:", Array.from(originalVideo.querySelectorAll('source')).map(s => s.src));
            console.log("ç»“æœè§†é¢‘å…ƒç´ sources:", Array.from(resultVideo.querySelectorAll('source')).map(s => s.src));
            
            // è®¾ç½®æ‘˜è¦æ•°æ®
            document.getElementById('behaviors-count').textContent = data.behaviors_count || 0;
            document.getElementById('max-confidence').textContent = 
                data.max_confidence ? `${(data.max_confidence * 100).toFixed(1)}%` : '0%';
            
            // è®¾ç½®è¡Œä¸ºç±»å‹æ ‡ç­¾
            const typesContainer = document.getElementById('behavior-types-container');
            typesContainer.innerHTML = '';
            
            if (data.behavior_types && data.behavior_types.length > 0) {
                data.behavior_types.forEach(type => {
                    const tag = document.createElement('span');
                    tag.className = 'behavior-tag';
                    tag.textContent = type;
                    typesContainer.appendChild(tag);
                });
            } else {
                typesContainer.innerHTML = '<div class="alert alert-info">æœªæ£€æµ‹åˆ°å¯ç–‘è¡Œä¸ºç±»å‹</div>';
            }
            
            // è®¾ç½®è¡Œä¸ºåˆ—è¡¨è¡¨æ ¼
            const behaviorsTable = document.getElementById('video-behaviors-table');
            behaviorsTable.innerHTML = '';
            
            if (data.behaviors && data.behaviors.length > 0) {
                data.behaviors.forEach(behavior => {
                    const row = document.createElement('tr');
                    
                    // æ—¶é—´ç‚¹å•å…ƒæ ¼
                    const timeCell = document.createElement('td');
                    timeCell.textContent = `${behavior.time.toFixed(2)}ç§’`;
                    row.appendChild(timeCell);
                    
                    // è¡Œä¸ºç±»å‹å•å…ƒæ ¼
                    const typeCell = document.createElement('td');
                    typeCell.textContent = behavior.type;
                    row.appendChild(typeCell);
                    
                    // ç½®ä¿¡åº¦å•å…ƒæ ¼
                    const confCell = document.createElement('td');
                    confCell.textContent = `${(behavior.confidence * 100).toFixed(1)}%`;
                    row.appendChild(confCell);
                    
                    // æ“ä½œå•å…ƒæ ¼
                    const actionCell = document.createElement('td');
                    const jumpBtn = document.createElement('button');
                    jumpBtn.className = 'btn btn-sm btn-primary jump-to-time';
                    jumpBtn.setAttribute('data-time', behavior.time);
                    jumpBtn.textContent = 'æŸ¥çœ‹';
                    actionCell.appendChild(jumpBtn);
                    row.appendChild(actionCell);
                    
                    behaviorsTable.appendChild(row);
                });
            } else {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = 4;
                cell.textContent = 'æœªæ£€æµ‹åˆ°å¯ç–‘è¡Œä¸º';
                row.appendChild(cell);
                behaviorsTable.appendChild(row);
            }
        }
        
        // è§†é¢‘æ’­æ”¾è·³è½¬åŠŸèƒ½
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('jump-to-time')) {
                const time = parseFloat(e.target.getAttribute('data-time'));
                if (!isNaN(time)) {
                    const video = document.getElementById('result-video');
                    if (video) {
                        video.currentTime = time;
                        video.play();
                    }
                }
            }
        });
    </script>
</body>
</html> 