<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PetPooja POS â€” Cashier Terminal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Syne:wght@400;600;700;800&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --navy: #1E293B;
      --blue: #3B82F6;
      --blue-light: #60A5FA;
      --bg: #F8FAFC;
      --red: #EF4444;
      --green: #10B981;
      --amber: #F59E0B;
      --slate-200: #E2E8F0;
      --slate-300: #CBD5E1;
      --slate-400: #94A3B8;
      --slate-600: #475569;
      --white: #FFFFFF;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.10);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.14);
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Syne', sans-serif;
      background: var(--bg);
      color: var(--navy);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      user-select: none;
    }

    /* â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      background: var(--navy);
      color: var(--white);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      height: 64px;
      flex-shrink: 0;
      position: relative;
      z-index: 10;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo-badge {
      background: var(--blue);
      border-radius: 8px;
      padding: 4px 10px;
      font-weight: 800;
      font-size: 13px;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .cashier-info h2 {
      font-size: 15px;
      font-weight: 700;
      line-height: 1;
    }

    .cashier-info span {
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      color: var(--slate-400);
    }

    .header-center {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }

    #clock {
      font-family: 'JetBrains Mono', monospace;
      font-size: 26px;
      font-weight: 700;
      color: var(--white);
      letter-spacing: 2px;
    }

    #date-str {
      font-size: 11px;
      color: var(--slate-400);
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .conn-status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      font-family: 'JetBrains Mono', monospace;
    }

    .conn-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--green);
      box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.5);
      animation: pulse-dot 2s infinite;
    }

    @keyframes pulse-dot {
      0% {
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.5);
      }

      70% {
        box-shadow: 0 0 0 6px rgba(16, 185, 129, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
      }
    }

    .shift-badge {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 6px;
      padding: 4px 10px;
      font-size: 12px;
      font-family: 'JetBrains Mono', monospace;
      color: var(--slate-300);
    }

    /* â”€â”€â”€ MAIN LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* â”€â”€â”€ LEFT: ITEM GRID + CART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .pos-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      padding: 16px;
      gap: 16px;
    }

    /* Category Tabs */
    .cat-tabs {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }

    .cat-tab {
      padding: 8px 16px;
      border-radius: 8px;
      border: 2px solid var(--slate-200);
      background: var(--white);
      font-family: 'Syne', sans-serif;
      font-weight: 600;
      font-size: 13px;
      color: var(--slate-600);
      cursor: pointer;
      transition: all 0.15s;
    }

    .cat-tab.active,
    .cat-tab:hover {
      background: var(--navy);
      border-color: var(--navy);
      color: var(--white);
    }

    /* Item Grid */
    .item-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      overflow-y: auto;
      flex: 1;
      padding-right: 4px;
    }

    .item-grid::-webkit-scrollbar {
      width: 4px;
    }

    .item-grid::-webkit-scrollbar-thumb {
      background: var(--slate-300);
      border-radius: 2px;
    }

    .item-card {
      background: var(--white);
      border: 2px solid var(--slate-200);
      border-radius: 12px;
      padding: 14px 12px;
      cursor: pointer;
      transition: all 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .item-card:hover {
      border-color: var(--blue);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .item-card:active {
      transform: scale(0.96);
    }

    .item-card .emoji {
      font-size: 28px;
      line-height: 1;
    }

    .item-card .item-name {
      font-size: 12px;
      font-weight: 700;
      color: var(--navy);
      line-height: 1.2;
    }

    .item-card .item-price {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      font-weight: 700;
      color: var(--blue);
    }

    .item-card .add-ripple {
      position: absolute;
      background: var(--blue);
      opacity: 0;
      border-radius: 50%;
      transform: scale(0);
      width: 80px;
      height: 80px;
      top: 50%;
      left: 50%;
      margin: -40px 0 0 -40px;
      pointer-events: none;
      animation: none;
    }

    @keyframes ripple {
      0% {
        transform: scale(0);
        opacity: 0.25;
      }

      100% {
        transform: scale(3);
        opacity: 0;
      }
    }

    /* â”€â”€â”€ CART / RIGHT PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .cart-panel {
      width: 320px;
      background: var(--white);
      border-left: 1px solid var(--slate-200);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .cart-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--slate-200);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .cart-header h3 {
      font-size: 15px;
      font-weight: 800;
      color: var(--navy);
    }

    .cart-count {
      background: var(--blue);
      color: white;
      border-radius: 20px;
      padding: 2px 8px;
      font-size: 12px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .cart-items {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
    }

    .cart-items::-webkit-scrollbar {
      width: 3px;
    }

    .cart-items::-webkit-scrollbar-thumb {
      background: var(--slate-200);
    }

    .cart-empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--slate-400);
      gap: 8px;
      font-size: 13px;
    }

    .cart-empty .cart-icon {
      font-size: 36px;
      opacity: 0.4;
    }

    .cart-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 8px;
      border-radius: 8px;
      border-bottom: 1px solid var(--slate-200);
      animation: slideIn 0.2s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(12px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .cart-row:last-child {
      border-bottom: none;
    }

    .cart-row .cr-name {
      flex: 1;
      font-size: 13px;
      font-weight: 600;
    }

    .cart-row .cr-qty {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .qty-btn {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      border: 1.5px solid var(--slate-200);
      background: var(--bg);
      cursor: pointer;
      font-size: 14px;
      font-weight: 700;
      color: var(--navy);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.1s;
    }

    .qty-btn:hover {
      background: var(--navy);
      color: white;
      border-color: var(--navy);
    }

    .qty-num {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      font-weight: 700;
      min-width: 20px;
      text-align: center;
    }

    .cart-row .cr-price {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      font-weight: 700;
      color: var(--navy);
      min-width: 56px;
      text-align: right;
    }

    .remove-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--slate-400);
      font-size: 16px;
      line-height: 1;
      transition: color 0.1s;
      padding: 2px;
    }

    .remove-btn:hover {
      color: var(--red);
    }

    /* Cart Summary */
    .cart-summary {
      padding: 14px 20px;
      border-top: 1px solid var(--slate-200);
      background: var(--bg);
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: var(--slate-600);
      margin-bottom: 4px;
      font-family: 'JetBrains Mono', monospace;
    }

    .summary-row.total {
      font-size: 18px;
      font-weight: 800;
      color: var(--navy);
      border-top: 2px solid var(--slate-200);
      padding-top: 10px;
      margin-top: 6px;
      font-family: 'Syne', sans-serif;
    }

    /* Payment Buttons */
    .pay-actions {
      padding: 14px 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      border-top: 1px solid var(--slate-200);
    }

    .pay-btn {
      width: 100%;
      padding: 13px 16px;
      border-radius: 10px;
      border: none;
      font-family: 'Syne', sans-serif;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
      letter-spacing: 0.3px;
    }

    .pay-btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .pay-btn:active {
      transform: scale(0.98);
    }

    .pay-btn.cash {
      background: var(--navy);
      color: white;
    }

    .pay-btn.upi {
      background: var(--blue);
      color: white;
    }

    .pay-btn.nosale {
      background: white;
      color: var(--amber);
      border: 2px solid var(--amber);
    }

    .pay-btn.void {
      background: white;
      color: var(--red);
      border: 2px solid rgba(239, 68, 68, 0.3);
      font-size: 12px;
      padding: 10px 16px;
    }

    .pay-row {
      display: flex;
      gap: 8px;
    }

    .pay-row .pay-btn {
      flex: 1;
    }

    /* â”€â”€â”€ SIDEBAR: RECENT LOGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .logs-panel {
      width: 240px;
      background: var(--navy);
      color: var(--white);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .logs-header {
      padding: 16px 16px 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logs-header h3 {
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--slate-400);
    }

    .live-badge {
      background: var(--red);
      color: white;
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.5px;
      animation: blink 1.5s infinite;
    }

    @keyframes blink {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .log-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }

    .log-list::-webkit-scrollbar {
      width: 3px;
    }

    .log-list::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.1);
    }

    .log-item {
      padding: 10px 10px;
      border-radius: 8px;
      margin-bottom: 6px;
      background: rgba(255, 255, 255, 0.05);
      border-left: 3px solid transparent;
      animation: logSlide 0.25s ease;
      transition: border-color 0.2s;
    }

    @keyframes logSlide {
      from {
        opacity: 0;
        transform: translateY(-8px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .log-item.cash {
      border-color: var(--green);
    }

    .log-item.upi {
      border-color: var(--blue);
    }

    .log-item.nosale {
      border-color: var(--amber);
    }

    .log-item.void {
      border-color: var(--red);
    }

    .log-type {
      font-size: 10px;
      font-weight: 800;
      letter-spacing: 0.8px;
      text-transform: uppercase;
      margin-bottom: 3px;
    }

    .log-item.cash .log-type {
      color: var(--green);
    }

    .log-item.upi .log-type {
      color: var(--blue-light);
    }

    .log-item.nosale .log-type {
      color: var(--amber);
    }

    .log-item.void .log-type {
      color: var(--red);
    }

    .log-amount {
      font-family: 'JetBrains Mono', monospace;
      font-size: 15px;
      font-weight: 700;
      color: white;
    }

    .log-time {
      font-family: 'JetBrains Mono', monospace;
      font-size: 10px;
      color: var(--slate-400);
      margin-top: 2px;
    }

    .log-items-str {
      font-size: 11px;
      color: var(--slate-400);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Shift Controls */
    .shift-controls {
      padding: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .shift-btn {
      width: 100%;
      padding: 9px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.05);
      color: var(--slate-300);
      font-family: 'Syne', sans-serif;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      letter-spacing: 0.3px;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .shift-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .shift-btn.danger {
      color: #FCA5A5;
      border-color: rgba(239, 68, 68, 0.25);
    }

    .shift-btn.danger:hover {
      background: rgba(239, 68, 68, 0.15);
      color: var(--red);
    }

    /* â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(4px);
      z-index: 100;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.open {
      display: flex;
    }

    .modal {
      background: white;
      border-radius: 20px;
      padding: 32px;
      width: 360px;
      box-shadow: var(--shadow-lg);
      animation: modalIn 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes modalIn {
      from {
        transform: scale(0.9);
        opacity: 0;
      }

      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .modal h2 {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 6px;
      color: var(--navy);
    }

    .modal .modal-sub {
      font-size: 13px;
      color: var(--slate-600);
      margin-bottom: 20px;
    }

    .modal-total {
      background: var(--bg);
      border-radius: 10px;
      padding: 14px 16px;
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-total .label {
      font-size: 13px;
      color: var(--slate-600);
    }

    .modal-total .amount {
      font-family: 'JetBrains Mono', monospace;
      font-size: 22px;
      font-weight: 700;
      color: var(--navy);
    }

    .modal-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--slate-200);
      border-radius: 10px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 18px;
      font-weight: 700;
      color: var(--navy);
      margin-bottom: 8px;
      outline: none;
      transition: border-color 0.15s;
    }

    .modal-input:focus {
      border-color: var(--blue);
    }

    .change-display {
      display: flex;
      justify-content: space-between;
      padding: 10px 16px;
      background: #ECFDF5;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 13px;
    }

    .change-display span {
      color: var(--slate-600);
    }

    .change-display strong {
      font-family: 'JetBrains Mono', monospace;
      font-size: 16px;
      color: var(--green);
    }

    .modal-actions {
      display: flex;
      gap: 8px;
    }

    .modal-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-family: 'Syne', sans-serif;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .modal-btn.confirm {
      background: var(--navy);
      color: white;
    }

    .modal-btn.confirm:hover {
      background: #0F172A;
    }

    .modal-btn.cancel {
      background: var(--bg);
      color: var(--navy);
      border: 2px solid var(--slate-200);
    }

    /* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toast-container {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 200;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .toast {
      padding: 12px 18px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 700;
      color: white;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: 8px;
      animation: toastIn 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
      min-width: 200px;
    }

    @keyframes toastIn {
      from {
        transform: translateX(60px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast.success {
      background: var(--green);
    }

    .toast.error {
      background: var(--red);
    }

    .toast.warning {
      background: var(--amber);
      color: white;
    }

    .toast.info {
      background: var(--blue);
    }

    /* â”€â”€â”€ NOSALE REASON MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .reason-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 16px;
    }

    .reason-btn {
      padding: 12px;
      border-radius: 8px;
      border: 2px solid var(--slate-200);
      background: var(--bg);
      font-family: 'Syne', sans-serif;
      font-weight: 600;
      font-size: 12px;
      cursor: pointer;
      text-align: center;
      color: var(--navy);
      transition: all 0.15s;
    }

    .reason-btn:hover,
    .reason-btn.selected {
      border-color: var(--amber);
      background: #FFFBEB;
      color: var(--amber);
    }

    /* Numpad */
    .numpad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      margin-bottom: 12px;
    }

    .nk {
      padding: 14px;
      border-radius: 8px;
      border: 1.5px solid var(--slate-200);
      background: var(--bg);
      font-family: 'JetBrains Mono', monospace;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      color: var(--navy);
      text-align: center;
      transition: all 0.1s;
    }

    .nk:hover {
      background: var(--navy);
      color: white;
      border-color: var(--navy);
    }

    .nk:active {
      transform: scale(0.94);
    }

    .nk.del {
      color: var(--red);
    }

    .nk.zero {
      grid-column: span 2;
    }

    /* TOGGLE SWITCH */
    .safety-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.1);
      padding: 6px 12px;
      border-radius: 20px;
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.15);
      transition: all 0.2s;
    }

    .safety-toggle:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .safety-toggle.active {
      background: rgba(16, 185, 129, 0.2);
      border-color: var(--green);
    }

    .t-knob {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #94A3B8;
      transition: all 0.2s;
    }

    .safety-toggle.active .t-knob {
      background: var(--green);
      box-shadow: 0 0 8px var(--green);
    }

    .t-label {
      font-size: 11px;
      font-weight: 700;
      color: #CBD5E1;
      text-transform: uppercase;
    }

    /* REPORT CARD */
    .report-card {
      background: #F8FAFC;
      border: 2px solid #E2E8F0;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .rep-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-bottom: 6px;
      color: #475569;
    }

    .rep-row.final {
      border-top: 1px solid #CBD5E1;
      padding-top: 8px;
      margin-top: 8px;
      font-weight: 700;
      color: #1E293B;
      font-size: 15px;
    }

    .rep-val {
      font-family: 'JetBrains Mono';
      font-weight: 700;
    }

    .rep-val.good {
      color: var(--green);
    }

    .rep-val.bad {
      color: var(--red);
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header>
    <div class="header-left">
      <div class="logo-badge">PetPooja</div>
      <div class="cashier-info">
        <h2>Riya Sharma</h2>
        <span>Store #PP-042 &nbsp;Â·&nbsp; Counter 1</span>
      </div>
    </div>

    <div class="header-center">
      <div id="clock">--:--:--</div>
      <div id="date-str">Loading...</div>
    </div>

    <div class="header-right">
      <div class="shift-badge" id="shift-label">SHIFT PENDING</div>
      <div class="shift-badge"
        style="background:rgba(16,185,129,0.15); border-color:rgba(16,185,129,0.3); color:#10B981;"
        id="cash-inventory-tag">
        ğŸ’ â‚¹0.00
      </div>

      <div class="safety-toggle" id="safetyToggle" onclick="toggleSafety()">
        <div class="t-knob"></div>
        <div class="t-label">MAINTENANCE</div>
      </div>

      <div class="conn-status">
        <div class="conn-dot" id="conn-dot"></div>
        <span id="conn-text" style="color:#94A3B8;font-size:12px;">CONNECTED</span>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <div class="main">

    <!-- POS PANEL -->
    <div class="pos-panel">
      <div class="cat-tabs" id="catTabs">
        <button class="cat-tab active" data-cat="all">All Items</button>
        <button class="cat-tab" data-cat="food">ğŸ› Food</button>
        <button class="cat-tab" data-cat="drinks">ğŸ¥¤ Drinks</button>
        <button class="cat-tab" data-cat="snacks">ğŸ¿ Snacks</button>
        <button class="cat-tab" data-cat="desserts">ğŸ° Desserts</button>
      </div>

      <div class="item-grid" id="itemGrid"></div>
    </div>

    <!-- CART PANEL -->
    <div class="cart-panel">
      <div class="cart-header">
        <h3>Current Order</h3>
        <span class="cart-count" id="cartCount">0</span>
      </div>

      <div class="cart-items" id="cartItems">
        <div class="cart-empty" id="cartEmpty">
          <span class="cart-icon">ğŸ›’</span>
          <span>Add items to begin</span>
        </div>
      </div>

      <div class="cart-summary" id="cartSummary" style="display:none;">
        <div class="summary-row"><span>Subtotal</span><span id="subtotal">â‚¹0.00</span></div>
        <div class="summary-row"><span>GST (5%)</span><span id="gstamt">â‚¹0.00</span></div>
        <div class="summary-row total"><span>TOTAL</span><span id="totalamt">â‚¹0.00</span></div>
      </div>

      <div class="pay-actions">
        <button class="pay-btn cash" onclick="openCashModal()">
          ğŸ’µ Cash Sale
        </button>
        <div class="pay-row">
          <button class="pay-btn upi" onclick="processUPI()">
            ğŸ“± UPI / Card
          </button>
          <button class="pay-btn nosale" onclick="openNoSaleModal()">
            ğŸ”“ No-Sale
          </button>
        </div>
        <button class="pay-btn void" onclick="voidOrder()">
          âœ• Void Order
        </button>
      </div>
    </div>

    <!-- LOGS PANEL -->
    <div class="logs-panel">
      <div class="logs-header">
        <h3>Recent Logs</h3>
        <span class="live-badge">LIVE</span>
      </div>

      <div class="log-list" id="logList">
        <div style="padding:20px; text-align:center; color:#475569; font-size:12px;">
          No transactions yet
        </div>
      </div>

      <div class="shift-controls">
        <button class="shift-btn" onclick="shiftEnd()">
          â¸ End Shift
        </button>
        <button class="shift-btn" onclick="dayEnd()">
          ğŸ“Š Day End Report
        </button>
        <button class="shift-btn danger" onclick="lockTerminal()">
          ğŸ”’ Lock Terminal
        </button>
      </div>
    </div>
  </div>

  <!-- CASH MODAL -->
  <div class="modal-overlay" id="cashModal">
    <div class="modal">
      <h2>ğŸ’µ Cash Payment</h2>
      <div class="modal-sub">Enter amount received from customer</div>
      <div class="modal-total">
        <span class="label">Order Total</span>
        <span class="amount" id="modalTotal">â‚¹0.00</span>
      </div>
      <input class="modal-input" id="cashReceived" placeholder="â‚¹ Amount received" readonly>
      <div class="numpad" id="numpad"></div>
      <div class="change-display">
        <span>Change to return</span>
        <strong id="changeAmt">â‚¹0.00</strong>
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" onclick="closeModal('cashModal')">Cancel</button>
        <button class="modal-btn confirm" onclick="confirmCash()">âœ“ Confirm Sale</button>
      </div>
    </div>
  </div>

  <!-- NO-SALE MODAL -->
  <div class="modal-overlay" id="noSaleModal">
    <div class="modal">
      <h2>ğŸ”“ No-Sale Open</h2>
      <div class="modal-sub">Select reason for opening cash drawer</div>
      <div class="reason-grid" id="reasonGrid">
        <button class="reason-btn" onclick="selectReason(this, 'Change for Customer')">ğŸ’± Change for Customer</button>
        <button class="reason-btn" onclick="selectReason(this, 'Float Adjustment')">âš–ï¸ Float Adjustment</button>
        <button class="reason-btn" onclick="selectReason(this, 'Petty Cash Out')">ğŸ’¸ Petty Cash Out</button>
        <button class="reason-btn" onclick="selectReason(this, 'Cash Count')">ğŸ”¢ Cash Count</button>
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" onclick="closeModal('noSaleModal')">Cancel</button>
        <button class="modal-btn confirm" onclick="confirmNoSale()" id="noSaleConfirm"
          style="opacity:0.5;pointer-events:none;">Open Drawer</button>
      </div>
    </div>
  </div>
  </div>

  <!-- START SHIFT MODAL -->
  <div class="modal-overlay" id="startShiftModal" style="z-index:300;">
    <div class="modal">
      <h2>ğŸš€ Start New Shift</h2>
      <div class="modal-sub">Please enter your details to begin logging</div>

      <input class="modal-input" id="cashierName" placeholder="Cashier Name"
        style="font-size:14px; margin-bottom:12px;">
      <input class="modal-input" id="initialCash" type="number" placeholder="â‚¹ Opening Float (e.g. 2000)"
        style="font-size:14px;">

      <div class="modal-actions" style="margin-top:20px;">
        <button class="modal-btn confirm" onclick="apiStartShift()">Start Shift</button>
      </div>
    </div>
  </div>

  <!-- END SHIFT MODAL -->
  <div class="modal-overlay" id="endShiftModal">
    <div class="modal">
      <h2>ğŸ End Shift</h2>
      <div class="modal-sub">Count the cash in drawer and enter below</div>

      <div class="modal-total">
        <span class="label">Expected Cash (System)</span>
        <span class="amount" id="expectedDisplay">Computing...</span>
      </div>

      <input class="modal-input" id="closingCash" type="number" placeholder="â‚¹ Actual Cash Count">

      <div class="modal-actions" style="margin-top:20px;">
        <button class="modal-btn cancel" onclick="closeModal('endShiftModal')">Cancel</button>
        <button class="modal-btn confirm" onclick="apiEndShift()">Submit & Close</button>
      </div>
    </div>
  </div>

  <!-- REPORT MODAL -->
  <div class="modal-overlay" id="reportModal">
    <div class="modal">
      <h2>ğŸ“Š Shift Report</h2>
      <div class="modal-sub">Summary of your shift performance</div>

      <div class="report-card" id="reportContent">
        <!-- JS filled -->
      </div>

      <div class="modal-actions">
        <button class="modal-btn confirm" onclick="location.reload()">Start New Shift</button>
      </div>
    </div>
  </div>

  <!-- TOAST CONTAINER -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
    // â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const ITEMS = [
      { id: 1, name: 'Paneer Burger', price: 149, emoji: 'ğŸ”', cat: 'food' },
      { id: 2, name: 'Veg Biryani', price: 189, emoji: 'ğŸ›', cat: 'food' },
      { id: 3, name: 'Masala Dosa', price: 99, emoji: 'ğŸ«“', cat: 'food' },
      { id: 4, name: 'Chole Bhature', price: 120, emoji: 'ğŸ«•', cat: 'food' },
      { id: 5, name: 'Aloo Paratha', price: 80, emoji: 'ğŸ¥™', cat: 'food' },
      { id: 6, name: 'Dal Makhani', price: 160, emoji: 'ğŸ²', cat: 'food' },
      { id: 7, name: 'Cold Coffee', price: 89, emoji: 'â˜•', cat: 'drinks' },
      { id: 8, name: 'Fresh Lime Soda', price: 60, emoji: 'ğŸ¥¤', cat: 'drinks' },
      { id: 9, name: 'Mango Shake', price: 99, emoji: 'ğŸ¥­', cat: 'drinks' },
      { id: 10, name: 'Masala Chai', price: 30, emoji: 'ğŸµ', cat: 'drinks' },
      { id: 11, name: 'Coconut Water', price: 50, emoji: 'ğŸ¥¥', cat: 'drinks' },
      { id: 12, name: 'Samosa (2pc)', price: 40, emoji: 'ğŸ¥Ÿ', cat: 'snacks' },
      { id: 13, name: 'Pav Bhaji', price: 110, emoji: 'ğŸ±', cat: 'snacks' },
      { id: 14, name: 'Kachori', price: 35, emoji: 'ğŸ«”', cat: 'snacks' },
      { id: 15, name: 'Bread Pakora', price: 55, emoji: 'ğŸ', cat: 'snacks' },
      { id: 16, name: 'Gulab Jamun', price: 60, emoji: 'ğŸ®', cat: 'desserts' },
      { id: 17, name: 'Kheer', price: 80, emoji: 'ğŸ§', cat: 'desserts' },
      { id: 18, name: 'Rabri', price: 70, emoji: 'ğŸ¨', cat: 'desserts' },
      { id: 19, name: 'Jalebi', price: 50, emoji: 'ğŸ¯', cat: 'desserts' },
      { id: 20, name: 'Rasmalai', price: 90, emoji: 'ğŸ°', cat: 'desserts' },
    ];

    let cart = {};
    let logs = [];
    let currentCat = 'all';
    let selectedReason = null;

    // â”€â”€â”€ CLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updateClock() {
      const now = new Date();
      const h = String(now.getHours()).padStart(2, '0');
      const m = String(now.getMinutes()).padStart(2, '0');
      const s = String(now.getSeconds()).padStart(2, '0');
      document.getElementById('clock').textContent = `${h}:${m}:${s}`;
      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      document.getElementById('date-str').textContent =
        `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;

      const hour = now.getHours();
      const label = hour < 12 ? 'MORNING SHIFT' : hour < 17 ? 'AFTERNOON SHIFT' : 'EVENING SHIFT';
      document.getElementById('shift-label').textContent = label;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Simulate connection flicker
    setInterval(() => {
      const dot = document.getElementById('conn-dot');
      const text = document.getElementById('conn-text');
      if (Math.random() < 0.97) {
        dot.style.background = 'var(--green)';
        text.textContent = 'CONNECTED';
        text.style.color = '#94A3B8';
      } else {
        dot.style.background = 'var(--amber)';
        text.textContent = 'RECONNECTING';
        text.style.color = '#F59E0B';
        setTimeout(() => {
          dot.style.background = 'var(--green)';
          text.textContent = 'CONNECTED';
          text.style.color = '#94A3B8';
        }, 1500);
      }
    }, 8000);

    // â”€â”€â”€ RENDER ITEMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderItems() {
      const grid = document.getElementById('itemGrid');
      const items = currentCat === 'all' ? ITEMS : ITEMS.filter(i => i.cat === currentCat);
      grid.innerHTML = items.map(item => `
    <div class="item-card" onclick="addToCart(${item.id}, this)">
      <div class="emoji">${item.emoji}</div>
      <div class="item-name">${item.name}</div>
      <div class="item-price">â‚¹${item.price}</div>
      <div class="add-ripple" id="ripple-${item.id}"></div>
    </div>
  `).join('');
    }

    // Category tabs
    document.getElementById('catTabs').addEventListener('click', e => {
      const btn = e.target.closest('.cat-tab');
      if (!btn) return;
      document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
      currentCat = btn.dataset.cat;
      renderItems();
    });

    // â”€â”€â”€ CART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addToCart(id, el) {
      const item = ITEMS.find(i => i.id === id);
      cart[id] = cart[id] || { ...item, qty: 0 };
      cart[id].qty++;
      renderCart();

      // Ripple
      const ripple = el.querySelector('.add-ripple');
      ripple.style.animation = 'none';
      ripple.offsetHeight;
      ripple.style.animation = 'ripple 0.5s ease forwards';
    }

    function changeQty(id, delta) {
      if (!cart[id]) return;
      cart[id].qty += delta;
      if (cart[id].qty <= 0) delete cart[id];
      renderCart();
    }

    function removeFromCart(id) {
      delete cart[id];
      renderCart();
    }

    function renderCart() {
      const keys = Object.keys(cart);
      const count = keys.reduce((a, k) => a + cart[k].qty, 0);
      document.getElementById('cartCount').textContent = count;

      const itemsEl = document.getElementById('cartItems');
      const emptyEl = document.getElementById('cartEmpty');
      const summaryEl = document.getElementById('cartSummary');

      if (keys.length === 0) {
        itemsEl.innerHTML = `<div class="cart-empty" id="cartEmpty"><span class="cart-icon">ğŸ›’</span><span>Add items to begin</span></div>`;
        summaryEl.style.display = 'none';
        return;
      }

      summaryEl.style.display = 'block';

      itemsEl.innerHTML = keys.map(k => {
        const it = cart[k];
        return `
      <div class="cart-row">
        <div class="cr-name">${it.emoji} ${it.name}</div>
        <div class="cr-qty">
          <button class="qty-btn" onclick="changeQty(${k}, -1)">âˆ’</button>
          <span class="qty-num">${it.qty}</span>
          <button class="qty-btn" onclick="changeQty(${k}, 1)">+</button>
        </div>
        <div class="cr-price">â‚¹${(it.price * it.qty).toFixed(0)}</div>
        <button class="remove-btn" onclick="removeFromCart(${k})">Ã—</button>
      </div>
    `;
      }).join('');

      const sub = keys.reduce((a, k) => a + cart[k].price * cart[k].qty, 0);
      const gst = sub * 0.05;
      const total = sub + gst;

      document.getElementById('subtotal').textContent = `â‚¹${sub.toFixed(2)}`;
      document.getElementById('gstamt').textContent = `â‚¹${gst.toFixed(2)}`;
      document.getElementById('totalamt').textContent = `â‚¹${total.toFixed(2)}`;
    }

    function getTotal() {
      const sub = Object.keys(cart).reduce((a, k) => a + cart[k].price * cart[k].qty, 0);
      return sub * 1.05;
    }

    function getOrderDesc() {
      const keys = Object.keys(cart);
      if (keys.length === 0) return 'Empty';
      return keys.slice(0, 2).map(k => cart[k].name).join(', ') + (keys.length > 2 ? `+${keys.length - 2}` : '');
    }

    // â”€â”€â”€ NUMPAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function buildNumpad() {
      const np = document.getElementById('numpad');
      const keys = ['7', '8', '9', '4', '5', '6', '1', '2', '3', 'DEL', '0', '.'];
      np.innerHTML = keys.map(k => `
    <button class="nk ${k === 'DEL' ? 'del' : ''} ${k === '0' ? '' : ''}
    " onclick="numpadKey('${k}')">${k === 'DEL' ? 'âŒ«' : k}</button>
  `).join('');
    }

    function numpadKey(k) {
      const input = document.getElementById('cashReceived');
      let val = input.value.replace('â‚¹', '');
      if (k === 'DEL') {
        val = val.slice(0, -1);
      } else if (k === '.') {
        if (!val.includes('.')) val += '.';
      } else {
        if (val.length < 8) val += k;
      }
      input.value = val ? `â‚¹${val}` : '';
      updateChange();
    }

    function updateChange() {
      const input = document.getElementById('cashReceived');
      const received = parseFloat(input.value.replace('â‚¹', '')) || 0;
      const total = getTotal();
      const change = received - total;
      document.getElementById('changeAmt').textContent = change >= 0 ? `â‚¹${change.toFixed(2)}` : `â‚¹0.00`;
      document.getElementById('changeAmt').style.color = change >= 0 ? 'var(--green)' : 'var(--red)';
    }

    // â”€â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openCashModal() {
      if (Object.keys(cart).length === 0) { showToast('Add items to cart first!', 'error'); return; }
      document.getElementById('modalTotal').textContent = `â‚¹${getTotal().toFixed(2)}`;
      document.getElementById('cashReceived').value = '';
      document.getElementById('changeAmt').textContent = 'â‚¹0.00';
      buildNumpad();
      document.getElementById('cashModal').classList.add('open');
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove('open');
    }

    // â”€â”€ UPDATED: CONFIRM CASH WITH BACKEND SYNC â”€â”€
    async function confirmCash() {
      const received = parseFloat(document.getElementById('cashReceived').value.replace('â‚¹', '')) || 0;
      const total = getTotal();

      // Validation
      if (received < total) {
        showToast('Amount insufficient!', 'error');
        return;
      }

      const change = received - total;
      const description = getOrderDesc();

      // 1. SYNC TO BACKEND (Crucial for the Sentinel AI to see the "Authorized" event)
      // We call this before clearing the UI so the AI sees the log immediately
      await syncEventToBackend('SALE', total, description, 'CASH');

      // Refresh Inventory Display
      updateInventoryDisplay(total);

      // 2. LOCAL UI UPDATES
      addLog('cash', total, description);
      closeModal('cashModal');
      clearCart();

      showToast(`âœ“ Cash sale complete! Change: â‚¹${change.toFixed(2)}`, 'success');
      drawerOpenAnimation('CASH SALE');
    }

    // â”€â”€ SYNC HELPER FUNCTION â”€â”€
    async function syncEventToBackend(type, amt, desc, mode = 'CASH') {
      const data = {
        transaction_id: "TX-" + Date.now(),
        event_type: type,
        amount: amt,
        description: desc, // Added to help the auditor identify the transaction
        payment_mode: mode
      };

      try {
        const response = await fetch('http://127.0.0.1:8000/api/pos-logs/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (!response.ok) throw new Error('Network response was not ok');
        console.log("âœ… Sentinel GEC: Log Synced to Backend");
      } catch (err) {
        console.error("âŒ Sync Failed (Backend Offline):", err);
        // We still let the user finish the sale, but warn that auditing is local-only
        showToast('Warning: Backend Offline. Logged locally only.', 'warning');
      }
    }

    async function processUPI() {
      if (Object.keys(cart).length === 0) { showToast('Add items to cart first!', 'error'); return; }
      const total = getTotal();
      const desc = getOrderDesc();

      // Sync to Backend
      await syncEventToBackend('SALE', total, desc + " (UPI)", 'UPI');

      addLog('upi', total, desc);
      clearCart();
      showToast('âœ“ UPI/Card payment recorded!', 'success');
      drawerOpenAnimation('UPI SALE');
    }

    function openNoSaleModal() {
      selectedReason = null;
      document.querySelectorAll('.reason-btn').forEach(b => b.classList.remove('selected'));
      document.getElementById('noSaleConfirm').style.opacity = '0.5';
      document.getElementById('noSaleConfirm').style.pointerEvents = 'none';
      document.getElementById('noSaleModal').classList.add('open');
    }

    function selectReason(el, reason) {
      document.querySelectorAll('.reason-btn').forEach(b => b.classList.remove('selected'));
      el.classList.add('selected');
      selectedReason = reason;
      document.getElementById('noSaleConfirm').style.opacity = '1';
      document.getElementById('noSaleConfirm').style.pointerEvents = 'auto';
    }

    async function confirmNoSale() {
      if (!selectedReason) return;

      // Sync to Backend
      await syncEventToBackend('NO_SALE', 0, selectedReason);

      addLog('nosale', 0, selectedReason);
      closeModal('noSaleModal');
      showToast(`ğŸ”“ No-Sale: ${selectedReason} â€” Logged`, 'warning');
      drawerOpenAnimation('NO-SALE');
    }

    async function voidOrder() {
      if (Object.keys(cart).length === 0) { showToast('Nothing to void.', 'error'); return; }
      const total = getTotal();
      const desc = getOrderDesc();

      // Sync to Backend
      await syncEventToBackend('VOID', total, desc);

      addLog('void', total, desc);
      clearCart();
      showToast('âœ• Order voided and logged.', 'error');
    }

    // â”€â”€â”€ LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addLog(type, amount, desc) {
      const now = new Date();
      const time = now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      const id = Date.now();
      const entry = { id, type, amount, desc, time };
      logs.unshift(entry);
      if (logs.length > 20) logs.pop();
      renderLogs();
    }

    function renderLogs() {
      const list = document.getElementById('logList');
      const show = logs.slice(0, 5);

      if (show.length === 0) {
        list.innerHTML = `<div style="padding:20px;text-align:center;color:#475569;font-size:12px;">No transactions yet</div>`;
        return;
      }

      const labels = { cash: 'CASH SALE', upi: 'UPI/CARD', nosale: 'NO-SALE', void: 'VOID' };

      list.innerHTML = show.map(log => `
    <div class="log-item ${log.type}">
      <div class="log-type">${labels[log.type]}</div>
      ${log.amount > 0 ? `<div class="log-amount">â‚¹${log.amount.toFixed(2)}</div>` : ''}
      <div class="log-items-str">${log.desc}</div>
      <div class="log-time">${log.time}</div>
    </div>
  `).join('');
    }

    // â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function clearCart() {
      cart = {};
      renderCart();
    }

    function showToast(msg, type = 'info') {
      const container = document.getElementById('toastContainer');
      const icons = { success: 'âœ…', error: 'âŒ', warning: 'âš ï¸', info: 'â„¹ï¸' };
      const el = document.createElement('div');
      el.className = `toast ${type}`;
      el.innerHTML = `<span>${icons[type]}</span> <span>${msg}</span>`;
      container.appendChild(el);
      setTimeout(() => el.remove(), 3500);
    }

    function drawerOpenAnimation(label) {
      // Visual feedback for drawer open event
      showToast(`ğŸ—ƒï¸ Cash drawer opened â€” ${label} logged to POS`, 'info');
    }

    async function shiftEnd() {
      // Sync to Backend
      await syncEventToBackend('NO_SALE', 0, 'SHIFT END â€” Drawer Float Count');

      addLog('nosale', 0, 'SHIFT END â€” Drawer Float Count');
      showToast('â¸ Shift end logged. Cash drawer opening for count.', 'warning');
      drawerOpenAnimation('SHIFT END');
    }

    async function dayEnd() {
      const total = logs.filter(l => l.type === 'cash').reduce((a, l) => a + l.amount, 0);

      // Sync to Backend
      await syncEventToBackend('NO_SALE', 0, 'DAY END â€” Final Count');

      showToast(`ğŸ“Š Day End: Cash Total â‚¹${total.toFixed(2)} â€” Report sent.`, 'info');
      addLog('nosale', 0, 'DAY END â€” Final Count');
    }

    function lockTerminal() {
      if (confirm('Lock terminal? A supervisor PIN will be required to unlock.')) {
        document.body.style.filter = 'blur(8px) brightness(0.3)';
        setTimeout(() => {
          const pin = prompt('Enter supervisor PIN to unlock:');
          if (pin === '1234') {
            document.body.style.filter = '';
            showToast('ğŸ”“ Terminal unlocked', 'success');
          } else {
            document.body.style.filter = '';
            showToast('âŒ Incorrect PIN. Contact manager.', 'error');
          }
        }, 200);
      }
    }

    // â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // â”€â”€â”€ SHIFT & SAFETY LOGIC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let currentShiftId = null;
    let safetyMode = false;

    async function checkActiveShift() {
      try {
        const res = await fetch('http://127.0.0.1:8000/api/shifts/current/');
        const data = await res.json();

        if (data.active === false || data.error) {
          document.getElementById('startShiftModal').classList.add('open');
          document.getElementById('shift-label').textContent = "NO ACTIVE SHIFT";
        } else {
          currentShiftId = data.id;
          document.querySelector('.cashier-info h2').textContent = data.cashier_name;
          document.getElementById('shift-label').textContent = "ACTIVE SHIFT";

          // Update Inventory Display
          const bal = data.expected_cash || data.initial_cash;
          document.getElementById('cash-inventory-tag').textContent = `ğŸ’ â‚¹${bal.toFixed(0)}`;

          showToast(`Welcome back, ${data.cashier_name}!`, 'success');
        }
      } catch (e) {
        console.error("Shift check failed", e);
        showToast("Backend Offline. Shift tracking disabled.", "error");
        // Force open for demo even if backend dead? No, better block.
        // For demo, we might want to bypass if backend is dead... 
        // But for now let's assume valid.
        document.getElementById('startShiftModal').classList.add('open');
      }
    }

    async function apiStartShift() {
      const name = document.getElementById('cashierName').value;
      const initial = parseFloat(document.getElementById('initialCash').value) || 0;

      if (!name) return showToast("Enter Cashier Name", "error");

      try {
        const res = await fetch('http://127.0.0.1:8000/api/shifts/start/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ cashier_name: name, initial_cash: initial })
        });

        if (res.ok) {
          const data = await res.json();
          currentShiftId = data.id;
          document.querySelector('.cashier-info h2').textContent = name;
          closeModal('startShiftModal');
          showToast("ğŸš€ Shift Started successfully!", "success");
          document.getElementById('shift-label').textContent = "ACTIVE SHIFT";
        }
      } catch (e) {
        showToast("Failed to start shift", "error");
      }
    }

    function shiftEndUI() {
      document.getElementById('endShiftModal').classList.add('open');
      document.getElementById('expectedDisplay').textContent = "Calc on Server...";
    }

    // Override the existing shiftEnd function
    shiftEnd = shiftEndUI;

    async function apiEndShift() {
      const actual = parseFloat(document.getElementById('closingCash').value) || 0;

      try {
        const res = await fetch('http://127.0.0.1:8000/api/shifts/end/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ actual_cash: actual })
        });

        if (res.ok) {
          const data = await res.json();
          closeModal('endShiftModal');
          showReport(data);
        }
      } catch (e) {
        showToast("Failed to end shift", "error");
      }
    }

    function showReport(data) {
      const diff = data.discrepancy;
      const isGood = Math.abs(diff) < 10;

      const html = `
        <div class="rep-row"><span>Opening Float</span><span class="rep-val">â‚¹${data.initial_cash}</span></div>
        <div class="rep-row"><span>Expected Cash</span><span class="rep-val">â‚¹${data.expected_cash}</span></div>
        <div class="rep-row"><span>Actual Count</span><span class="rep-val">â‚¹${data.actual_cash}</span></div>
        <div class="rep-row final">
            <span>Discrepancy</span>
            <span class="rep-val ${isGood ? 'good' : 'bad'}">${diff > 0 ? '+' : ''}${diff.toFixed(2)}</span>
        </div>
        <div style="font-size:11px; margin-top:8px; color:#64748B;">
            ${isGood ? 'âœ… Balanced perfectly!' : 'âš ï¸ Discrepancy logged to Blockchain.'}
        </div>
    `;
      document.getElementById('reportContent').innerHTML = html;
      document.getElementById('reportModal').classList.add('open');
    }

    async function updateInventoryDisplay(addAmount = 0) {
      // Optimistic update
      const el = document.getElementById('cash-inventory-tag');
      let curr = parseFloat(el.textContent.replace(/[^\d.]/g, '')) || 0;
      curr += addAmount;
      el.textContent = `ğŸ’ â‚¹${curr.toFixed(0)}`;

      // Background sync
      try {
        const res = await fetch('http://127.0.0.1:8000/api/shifts/current/');
        const data = await res.json();
        if (data.expected_cash) {
          el.textContent = `ğŸ’ â‚¹${data.expected_cash.toFixed(0)}`;
        }
      } catch (e) { }
    }

    async function toggleSafety() {
      safetyMode = !safetyMode;
      const btn = document.getElementById('safetyToggle');
      const label = btn.querySelector('.t-label');

      if (safetyMode) {
        btn.classList.add('active');
        label.textContent = "MAINTENANCE ON";
        showToast("ğŸ”§ Maintenance Mode ACTIVE. Alerts Suppressed.", "warning");
      } else {
        btn.classList.remove('active');
        label.textContent = "MAINTENANCE";
        showToast("ğŸ›¡ï¸ Security Active. Monitoring enabled.", "success");
      }

      // Log to Backend
      if (currentShiftId) {
        fetch('http://127.0.0.1:8000/api/safety-logs/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            shift: currentShiftId,
            action: safetyMode ? 'ON' : 'OFF'
          })
        });
      }
    }

    // â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    renderItems();
    renderLogs();
    checkActiveShift();
  </script>
</body>

</html>